<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>18.Vue原码分析 | Harry Xiong</title>
    <meta name="generator" content="VuePress 1.5.0">
    <link rel="icon" href="/p128px.ico">
    <link rel="manifest" href="/manifest.json">
    <link rel="apple-touch-icon" href="/p128px.ico">
    <meta name="description" content="日拱一卒, 功不唐捐">
    <meta property="og:url" content="https://www.harryxiong24.com/FrontEnd/Vue/vue18.html">
    <meta property="og:site_name" content="Harry Xiong">
    <meta property="og:title" content="18.Vue原码分析">
    <meta property="og:type" content="article">
    <meta property="og:locale" content="zh-CN">
    <meta property="og:locale:alternate" content="en-US">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image:alt" content="Harry Xiong">
    <meta property="article:author" content="Harry Xiong">
    <meta property="article:tag" content="Vue">
    <meta property="article:published_time" content="2020-06-17T16:00:00.000Z">
    <meta name="baidu-site-verification" content="Osv8SVNDzm">
    <meta name="keywords" content="IT, Blog, Internet, sharing, IT skill">
    <meta name="author" content="Harry Xiong">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#46bd87">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/p128px.ico">
    <meta name="msapplication-TileColor" content="#ffffff">
    <link rel="preload" href="/assets/css/0.styles.fba0a66d.css" as="style"><link rel="preload" href="/assets/js/app.985acdd6.js" as="script"><link rel="preload" href="/assets/js/vendors~layout-Layout.6602fab5.js" as="script"><link rel="preload" href="/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound.325e3bb0.js" as="script"><link rel="preload" href="/assets/js/vendors~layout-Blog~layout-Layout.90f03575.js" as="script"><link rel="preload" href="/assets/js/page-18.Vue原码分析.45166ab7.js" as="script"><link rel="prefetch" href="/assets/js/layout-Blog.9086e5b0.js"><link rel="prefetch" href="/assets/js/layout-NotFound.ef539af8.js"><link rel="prefetch" href="/assets/js/page--47edc0ca.bd1e2df1.js"><link rel="prefetch" href="/assets/js/page-1.JavaScript 简介.4865dd7c.js"><link rel="prefetch" href="/assets/js/page-1.Servlet简介.24313a71.js"><link rel="prefetch" href="/assets/js/page-1.Vue简介.3b65cbd2.js"><link rel="prefetch" href="/assets/js/page-1.序言.c2c0cc5d.js"><link rel="prefetch" href="/assets/js/page-1.节点.78f6dce2.js"><link rel="prefetch" href="/assets/js/page-10.JSP.adf36a4a.js"><link rel="prefetch" href="/assets/js/page-10.函数对象.e1425164.js"><link rel="prefetch" href="/assets/js/page-10.拖拽事件.c45441ac.js"><link rel="prefetch" href="/assets/js/page-10.解构赋值.fc1dae8a.js"><link rel="prefetch" href="/assets/js/page-10.过滤器.7c3119f3.js"><link rel="prefetch" href="/assets/js/page-11.JDBC.52a1e1e0.js"><link rel="prefetch" href="/assets/js/page-11.新增运算符.88143ca9.js"><link rel="prefetch" href="/assets/js/page-11.滚轮事件.44e36074.js"><link rel="prefetch" href="/assets/js/page-11.类对象.22c18f69.js"><link rel="prefetch" href="/assets/js/page-11.自定义指令.29841340.js"><link rel="prefetch" href="/assets/js/page-12.JS特殊类实例.9e8a0d8a.js"><link rel="prefetch" href="/assets/js/page-12.异步编程.123b074c.js"><link rel="prefetch" href="/assets/js/page-12.组件.ca021930.js"><link rel="prefetch" href="/assets/js/page-12.键盘事件.5620ed75.js"><link rel="prefetch" href="/assets/js/page-13.BOM.4cc19d0e.js"><link rel="prefetch" href="/assets/js/page-13.Set.c6447da4.js"><link rel="prefetch" href="/assets/js/page-13.正则表达式.e2324f94.js"><link rel="prefetch" href="/assets/js/page-13.组件之间的通信方式.4b0be211.js"><link rel="prefetch" href="/assets/js/page-14.Map.9159134a.js"><link rel="prefetch" href="/assets/js/page-14.Vue-Router.fc7e2d05.js"><link rel="prefetch" href="/assets/js/page-14.定时器.8d7bf7df.js"><link rel="prefetch" href="/assets/js/page-15.Iterator.c49ad764.js"><link rel="prefetch" href="/assets/js/page-15.Set.70a7c119.js"><link rel="prefetch" href="/assets/js/page-15.Vuex.85536341.js"><link rel="prefetch" href="/assets/js/page-16.Map.b3df7396.js"><link rel="prefetch" href="/assets/js/page-16.对象数组更新.158c1f73.js"><link rel="prefetch" href="/assets/js/page-16.异步遍历器.18f3b36c.js"><link rel="prefetch" href="/assets/js/page-17.Mixins.8ab8e5e2.js"><link rel="prefetch" href="/assets/js/page-17.Module.a61a9f1d.js"><link rel="prefetch" href="/assets/js/page-17.Proxy.98bbf74c.js"><link rel="prefetch" href="/assets/js/page-18.Promise.72a74228.js"><link rel="prefetch" href="/assets/js/page-18.Reflect.8f55329c.js"><link rel="prefetch" href="/assets/js/page-19.Generator.77999524.js"><link rel="prefetch" href="/assets/js/page-19.Module模块化.27eec4a0.js"><link rel="prefetch" href="/assets/js/page-2.DOM事件.bfe57aac.js"><link rel="prefetch" href="/assets/js/page-2.JS基本操作.a596a85f.js"><link rel="prefetch" href="/assets/js/page-2.Servlet生命周期.bea34c11.js"><link rel="prefetch" href="/assets/js/page-2.Vue实例对象.86e51794.js"><link rel="prefetch" href="/assets/js/page-2.基础关注点.19f84a0f.js"><link rel="prefetch" href="/assets/js/page-20.async.9812438d.js"><link rel="prefetch" href="/assets/js/page-20.模块加载的实现.ba1422bc.js"><link rel="prefetch" href="/assets/js/page-21.DOM.d62eedd1.js"><link rel="prefetch" href="/assets/js/page-21.Iterator.905413df.js"><link rel="prefetch" href="/assets/js/page-22.DOM事件.27d169e8.js"><link rel="prefetch" href="/assets/js/page-22.Proxy.dc548d74.js"><link rel="prefetch" href="/assets/js/page-23.BOM.2cde669e.js"><link rel="prefetch" href="/assets/js/page-23.Reflect.89da90b5.js"><link rel="prefetch" href="/assets/js/page-24.编程风格.61a3d67b.js"><link rel="prefetch" href="/assets/js/page-24.错误处理.7bf7326f.js"><link rel="prefetch" href="/assets/js/page-25.正则表达式.6d99e922.js"><link rel="prefetch" href="/assets/js/page-26.标准对象库.87e73190.js"><link rel="prefetch" href="/assets/js/page-3.DOM查询.52f0ff1c.js"><link rel="prefetch" href="/assets/js/page-3.变量及数据类型.cf27e2c9.js"><link rel="prefetch" href="/assets/js/page-3.基本指令.ff5ca154.js"><link rel="prefetch" href="/assets/js/page-3.数据类型的检验和转换.6ca64e32.js"><link rel="prefetch" href="/assets/js/page-3.表单提交数据.952d182f.js"><link rel="prefetch" href="/assets/js/page-4.元素样式.d26ea206.js"><link rel="prefetch" href="/assets/js/page-4.计算属性与监视.f323b903.js"><link rel="prefetch" href="/assets/js/page-4.请求与响应.92067317.js"><link rel="prefetch" href="/assets/js/page-4.运算符.6ec640f4.js"><link rel="prefetch" href="/assets/js/page-4.错误处理机制.00e19f87.js"><link rel="prefetch" href="/assets/js/page-5.Array.f34ea30e.js"><link rel="prefetch" href="/assets/js/page-5.事件对象.5cbed19e.js"><link rel="prefetch" href="/assets/js/page-5.文件上传.97306aa2.js"><link rel="prefetch" href="/assets/js/page-5.绑定class和style.73275732.js"><link rel="prefetch" href="/assets/js/page-5.逻辑语句.e48d29c1.js"><link rel="prefetch" href="/assets/js/page-6.String.0b746c9e.js"><link rel="prefetch" href="/assets/js/page-6.Vue基本操作.3843fe00.js"><link rel="prefetch" href="/assets/js/page-6.事件的冒泡(Bubble).acbd0614.js"><link rel="prefetch" href="/assets/js/page-6.循环语句.ef127274.js"><link rel="prefetch" href="/assets/js/page-6.网页跳转与重定向.1bb5ff82.js"><link rel="prefetch" href="/assets/js/page-7.Object.f4891e56.js"><link rel="prefetch" href="/assets/js/page-7.一般对象.ee5ecf13.js"><link rel="prefetch" href="/assets/js/page-7.事件的委派.fd133328.js"><link rel="prefetch" href="/assets/js/page-7.会话管理.b6b6c4f5.js"><link rel="prefetch" href="/assets/js/page-7.按键修饰符.00901cbf.js"><link rel="prefetch" href="/assets/js/page-8.Class.f9517e44.js"><link rel="prefetch" href="/assets/js/page-8.ServletContext.9b4acafc.js"><link rel="prefetch" href="/assets/js/page-8.Vue的生命周期.f87fb6b9.js"><link rel="prefetch" href="/assets/js/page-8.事件的绑定.4af4ba10.js"><link rel="prefetch" href="/assets/js/page-8.数组.d9e5a6fc.js"><link rel="prefetch" href="/assets/js/page-9.Symbol.284c94f5.js"><link rel="prefetch" href="/assets/js/page-9.事件的传播.715c8810.js"><link rel="prefetch" href="/assets/js/page-9.字符串方法.5918e90f.js"><link rel="prefetch" href="/assets/js/page-9.过渡与动画.13d05b0e.js"><link rel="prefetch" href="/assets/js/page-9.过滤器.2cbadf3d.js"><link rel="prefetch" href="/assets/js/page-AJAX.0940abf8.js"><link rel="prefetch" href="/assets/js/page-Ajax.48874dd9.js"><link rel="prefetch" href="/assets/js/page-Apache.76b14c33.js"><link rel="prefetch" href="/assets/js/page-ArrayBuffer.bb0986c1.js"><link rel="prefetch" href="/assets/js/page-Bootstrap 之栅格系统.199c058b.js"><link rel="prefetch" href="/assets/js/page-CSS.260e218a.js"><link rel="prefetch" href="/assets/js/page-CentOS 教程.048441fb.js"><link rel="prefetch" href="/assets/js/page-Class 的基本语法.728b90b4.js"><link rel="prefetch" href="/assets/js/page-Class 的继承.5bd42fc1.js"><link rel="prefetch" href="/assets/js/page-DOM Diff 算法.1bebedb3.js"><link rel="prefetch" href="/assets/js/page-DOM&BOM.04cdbad7.js"><link rel="prefetch" href="/assets/js/page-DataStorage.6b75ac61.js"><link rel="prefetch" href="/assets/js/page-ES6 简介.542e8361.js"><link rel="prefetch" href="/assets/js/page-Express.96075332.js"><link rel="prefetch" href="/assets/js/page-Generator 异步应用.d1accaaf.js"><link rel="prefetch" href="/assets/js/page-Generator.d3c1590d.js"><link rel="prefetch" href="/assets/js/page-Git Large File Storage.ebb7eb6a.js"><link rel="prefetch" href="/assets/js/page-Git 安装与配置.e05fe01e.js"><link rel="prefetch" href="/assets/js/page-Git 总体介绍.bd826b0f.js"><link rel="prefetch" href="/assets/js/page-Git 版本库.5c33a163.js"><link rel="prefetch" href="/assets/js/page-Git.213530af.js"><link rel="prefetch" href="/assets/js/page-Github Pages.23d33974.js"><link rel="prefetch" href="/assets/js/page-Github 教程.9a8b08f2.js"><link rel="prefetch" href="/assets/js/page-HTML.2bea0d7b.js"><link rel="prefetch" href="/assets/js/page-HTML进阶.34339966.js"><link rel="prefetch" href="/assets/js/page-Hello TypeScript.c216fd93.js"><link rel="prefetch" href="/assets/js/page-Home.7d3dfab9.js"><link rel="prefetch" href="/assets/js/page-Http 与 Https 介绍.239f742c.js"><link rel="prefetch" href="/assets/js/page-Iterator 和 for...of 循环.048d810f.js"><link rel="prefetch" href="/assets/js/page-JavaScript.247b8622.js"><link rel="prefetch" href="/assets/js/page-Less.e00bdc06.js"><link rel="prefetch" href="/assets/js/page-Linux 命令基本格式.7298b192.js"><link rel="prefetch" href="/assets/js/page-Linux 命令执行过程.16c1952a.js"><link rel="prefetch" href="/assets/js/page-Linux 命令格式.20b18f90.js"><link rel="prefetch" href="/assets/js/page-Linux 和 UNIX.279e726c.js"><link rel="prefetch" href="/assets/js/page-Linux 挂载.17cc7be5.js"><link rel="prefetch" href="/assets/js/page-Linux 文件.d94e62d1.js"><link rel="prefetch" href="/assets/js/page-Linux 文件目录结构.d02d24ab.js"><link rel="prefetch" href="/assets/js/page-Linux 的优点.c8374a44.js"><link rel="prefetch" href="/assets/js/page-Linux 简介.d11b104a.js"><link rel="prefetch" href="/assets/js/page-Linux 系统启动过程.c11232a7.js"><link rel="prefetch" href="/assets/js/page-Linux.6e9cdd25.js"><link rel="prefetch" href="/assets/js/page-Markdown基本语法.6eb8d28a.js"><link rel="prefetch" href="/assets/js/page-Mixin.4a17ffad.js"><link rel="prefetch" href="/assets/js/page-Module 的加载实现.c103eb63.js"><link rel="prefetch" href="/assets/js/page-Module 的语法.b51c89f4.js"><link rel="prefetch" href="/assets/js/page-Nginx.04bf7489.js"><link rel="prefetch" href="/assets/js/page-Promise 对象.dbaa4a46.js"><link rel="prefetch" href="/assets/js/page-Proxy.7dbe6556.js"><link rel="prefetch" href="/assets/js/page-Python 基础.60912d19.js"><link rel="prefetch" href="/assets/js/page-Python 安装.8c5caccf.js"><link rel="prefetch" href="/assets/js/page-Python 快速入门.f680bfd8.js"><link rel="prefetch" href="/assets/js/page-Python 简介.691877c6.js"><link rel="prefetch" href="/assets/js/page-Python 解释器.71a5fc27.js"><link rel="prefetch" href="/assets/js/page-Python 高级语法.8c2c75cc.js"><link rel="prefetch" href="/assets/js/page-Python.13c2aebb.js"><link rel="prefetch" href="/assets/js/page-Reflect.fd2ed38f.js"><link rel="prefetch" href="/assets/js/page-SIMD.7c1ca78d.js"><link rel="prefetch" href="/assets/js/page-Sass.09a25701.js"><link rel="prefetch" href="/assets/js/page-Servlet&JSP.0d470f19.js"><link rel="prefetch" href="/assets/js/page-Set 和 Map 数据结构.02ae2db1.js"><link rel="prefetch" href="/assets/js/page-Symbol.b726d36d.js"><link rel="prefetch" href="/assets/js/page-TypeScript 教程.135ca2a9.js"><link rel="prefetch" href="/assets/js/page-VSCode 安装.b23d8003.js"><link rel="prefetch" href="/assets/js/page-VSCode 快捷键说明.22c5b6e2.js"><link rel="prefetch" href="/assets/js/page-VSCode 扩展使用说明.8ad936fc.js"><link rel="prefetch" href="/assets/js/page-VSCode 推荐配置.245e84e5.js"><link rel="prefetch" href="/assets/js/page-VSCode 的简单介绍.e137b94e.js"><link rel="prefetch" href="/assets/js/page-VSCode.1ea88127.js"><link rel="prefetch" href="/assets/js/page-Virtual Dom.e7daebde.js"><link rel="prefetch" href="/assets/js/page-Vue.f0b6b9e6.js"><link rel="prefetch" href="/assets/js/page-WSL.89b75d1d.js"><link rel="prefetch" href="/assets/js/page-Webpack.7a03f5a7.js"><link rel="prefetch" href="/assets/js/page-async 函数.897a3803.js"><link rel="prefetch" href="/assets/js/page-dict 和 set.0ee700cb.js"><link rel="prefetch" href="/assets/js/page-dir 相关.0ca9b2a3.js"><link rel="prefetch" href="/assets/js/page-es6 入门.b0cf209b.js"><link rel="prefetch" href="/assets/js/page-filter.9743708b.js"><link rel="prefetch" href="/assets/js/page-jQuery 介绍.043dc7cd.js"><link rel="prefetch" href="/assets/js/page-jQuery.f7422445.js"><link rel="prefetch" href="/assets/js/page-let 和 const 命令.581daea2.js"><link rel="prefetch" href="/assets/js/page-list 和 tuple.9e1e7b2b.js"><link rel="prefetch" href="/assets/js/page-ln 创建链接的深度剖析.37c0efd3.js"><link rel="prefetch" href="/assets/js/page-sorted.da32f373.js"><link rel="prefetch" href="/assets/js/page-ssh.81fe123f.js"><link rel="prefetch" href="/assets/js/page-ubuntu.fc8b6d52.js"><link rel="prefetch" href="/assets/js/page-事件.a973611a.js"><link rel="prefetch" href="/assets/js/page-什么是 TypeScript.b19eb60c.js"><link rel="prefetch" href="/assets/js/page-介绍.811915d4.js"><link rel="prefetch" href="/assets/js/page-代码检查.18c1a49a.js"><link rel="prefetch" href="/assets/js/page-任意值.2c8b7ab5.js"><link rel="prefetch" href="/assets/js/page-信息安全理论与技术.b7858f1b.js"><link rel="prefetch" href="/assets/js/page-修改 DOM 结构.4df2f52f.js"><link rel="prefetch" href="/assets/js/page-修改管理.8ad9e0b2.js"><link rel="prefetch" href="/assets/js/page-修饰器.bb48653f.js"><link rel="prefetch" href="/assets/js/page-元组.d098f384.js"><link rel="prefetch" href="/assets/js/page-其他指令.75eeb637.js"><link rel="prefetch" href="/assets/js/page-其他文件目录相关命令.a01af732.js"><link rel="prefetch" href="/assets/js/page-内置对象.ed98f939.js"><link rel="prefetch" href="/assets/js/page-写在前面.c487ecc3.js"><link rel="prefetch" href="/assets/js/page-写在后面-对 css 预处理的补充.57101482.js"><link rel="prefetch" href="/assets/js/page-写在后面-对H5&CSS的补充.6bed42c0.js"><link rel="prefetch" href="/assets/js/page-函数.30c5ecf7.js"><link rel="prefetch" href="/assets/js/page-函数介绍.4759ac26.js"><link rel="prefetch" href="/assets/js/page-函数式编程.a94e6c2a.js"><link rel="prefetch" href="/assets/js/page-函数的参数.725261ef.js"><link rel="prefetch" href="/assets/js/page-函数的扩展.788ad521.js"><link rel="prefetch" href="/assets/js/page-函数的类型.d2816fcb.js"><link rel="prefetch" href="/assets/js/page-分支管理.467b716b.js"><link rel="prefetch" href="/assets/js/page-切片.37300d16.js"><link rel="prefetch" href="/assets/js/page-列表生成式.85a4f356.js"><link rel="prefetch" href="/assets/js/page-动画.be5188cd.js"><link rel="prefetch" href="/assets/js/page-原始数据类型.4fcbb11e.js"><link rel="prefetch" href="/assets/js/page-参考链接.d921d660.js"><link rel="prefetch" href="/assets/js/page-变量的解构赋值.68d6610f.js"><link rel="prefetch" href="/assets/js/page-基础.bfac3661.js"><link rel="prefetch" href="/assets/js/page-基础介绍.e08549f3.js"><link rel="prefetch" href="/assets/js/page-基础知识.9e81706f.js"><link rel="prefetch" href="/assets/js/page-声明合并.76bc9096.js"><link rel="prefetch" href="/assets/js/page-声明文件.438ae31d.js"><link rel="prefetch" href="/assets/js/page-大前端学习路线.9079cfde.js"><link rel="prefetch" href="/assets/js/page-大后端学习路线.63a4b3e3.js"><link rel="prefetch" href="/assets/js/page-字符串.31657932.js"><link rel="prefetch" href="/assets/js/page-字符串字面量类型.ec61f685.js"><link rel="prefetch" href="/assets/js/page-字符串的扩展.90e6c3b2.js"><link rel="prefetch" href="/assets/js/page-安装 TypeScript.c4765616.js"><link rel="prefetch" href="/assets/js/page-定义函数.fc13f091.js"><link rel="prefetch" href="/assets/js/page-对象的扩展.7b75acd6.js"><link rel="prefetch" href="/assets/js/page-对象的类型——接口.5f6e1e8a.js"><link rel="prefetch" href="/assets/js/page-工作区和暂存区.b93ee7b5.js"><link rel="prefetch" href="/assets/js/page-工程.1ef0217e.js"><link rel="prefetch" href="/assets/js/page-常用快捷键.a324b5bd.js"><link rel="prefetch" href="/assets/js/page-开发软件.3abe398d.js"><link rel="prefetch" href="/assets/js/page-循环.827ac64e.js"><link rel="prefetch" href="/assets/js/page-打开命令行.d56aa371.js"><link rel="prefetch" href="/assets/js/page-扩展.03e5bb77.js"><link rel="prefetch" href="/assets/js/page-扩展阅读.7547f70a.js"><link rel="prefetch" href="/assets/js/page-操作 DOM.d38b2b20.js"><link rel="prefetch" href="/assets/js/page-操作系统.8e79c247.js"><link rel="prefetch" href="/assets/js/page-数值的扩展.7af39b63.js"><link rel="prefetch" href="/assets/js/page-数组的扩展.28d3f7c9.js"><link rel="prefetch" href="/assets/js/page-数组的类型.c3fcab5d.js"><link rel="prefetch" href="/assets/js/page-文件.78075642.js"><link rel="prefetch" href="/assets/js/page-文件名与文件扩展名.257809ef.js"><link rel="prefetch" href="/assets/js/page-文件命令.c976258b.js"><link rel="prefetch" href="/assets/js/page-最新提案.b25bdd5e.js"><link rel="prefetch" href="/assets/js/page-条件判断.845b1e9c.js"><link rel="prefetch" href="/assets/js/page-来自Harry的自述.8c4c85d3.js"><link rel="prefetch" href="/assets/js/page-枚举.9aede12b.js"><link rel="prefetch" href="/assets/js/page-标签管理.6efa4c92.js"><link rel="prefetch" href="/assets/js/page-桌面系统.69f50e13.js"><link rel="prefetch" href="/assets/js/page-正则的扩展.e4ecf1d0.js"><link rel="prefetch" href="/assets/js/page-泛型.0b82c6e0.js"><link rel="prefetch" href="/assets/js/page-浏览器渲染原理及性能优化.4d8e8543.js"><link rel="prefetch" href="/assets/js/page-版本回退.9ad92853.js"><link rel="prefetch" href="/assets/js/page-环境变量.a244557f.js"><link rel="prefetch" href="/assets/js/page-环境变量的添加.4c0fd58f.js"><link rel="prefetch" href="/assets/js/page-生命之歌.53a090af.js"><link rel="prefetch" href="/assets/js/page-生成器.2796c493.js"><link rel="prefetch" href="/assets/js/page-第一个 Python 程序.28f06127.js"><link rel="prefetch" href="/assets/js/page-第七次更新!(1.4.1).79d27843.js"><link rel="prefetch" href="/assets/js/page-第三次更新!(1.1.6).ee66ead5.js"><link rel="prefetch" href="/assets/js/page-第九次更新!(1.4.3).b353ef2b.js"><link rel="prefetch" href="/assets/js/page-第二次更新!(1.0.6).5a506316.js"><link rel="prefetch" href="/assets/js/page-第五次更新!(1.3.1).aa3dcbf5.js"><link rel="prefetch" href="/assets/js/page-第八次更新!(1.4.2).5491b179.js"><link rel="prefetch" href="/assets/js/page-第六次更新!(1.3.4).5a598407.js"><link rel="prefetch" href="/assets/js/page-第十一次更新!(1.4.6).92c7cf50.js"><link rel="prefetch" href="/assets/js/page-第十二次更新!(1.5.8).2464c3b4.js"><link rel="prefetch" href="/assets/js/page-第十次更新!(1.4.4).2e8a62bf.js"><link rel="prefetch" href="/assets/js/page-第四次更新!(1.2.3).aa18e06b.js"><link rel="prefetch" href="/assets/js/page-简介.7e4bb25d.js"><link rel="prefetch" href="/assets/js/page-管理工具.535df5d2.js"><link rel="prefetch" href="/assets/js/page-类.e67448c3.js"><link rel="prefetch" href="/assets/js/page-类与接口.56e89711.js"><link rel="prefetch" href="/assets/js/page-类型别名.e02fc4d2.js"><link rel="prefetch" href="/assets/js/page-类型推论.d95052ec.js"><link rel="prefetch" href="/assets/js/page-类型断言.55dcf8b0.js"><link rel="prefetch" href="/assets/js/page-纵向查看.54039e2a.js"><link rel="prefetch" href="/assets/js/page-练习.107178aa.js"><link rel="prefetch" href="/assets/js/page-编程风格.60c9f419.js"><link rel="prefetch" href="/assets/js/page-网络服务器相关.a2fbb83c.js"><link rel="prefetch" href="/assets/js/page-联合类型.5afe08ef.js"><link rel="prefetch" href="/assets/js/page-联系Harry.dff64e1c.js"><link rel="prefetch" href="/assets/js/page-自定义 Git.cdc59974.js"><link rel="prefetch" href="/assets/js/page-萤火.160667db.js"><link rel="prefetch" href="/assets/js/page-补全.d2dc00af.js"><link rel="prefetch" href="/assets/js/page-计算机编码介绍.98755bfb.js"><link rel="prefetch" href="/assets/js/page-诞生啦!!!(1.0.1).a7c44473.js"><link rel="prefetch" href="/assets/js/page-语言.b30f7078.js"><link rel="prefetch" href="/assets/js/page-语言切换.56ff9e16.js"><link rel="prefetch" href="/assets/js/page-读懂 ECMAScript 规格.0078f895.js"><link rel="prefetch" href="/assets/js/page-调用函数.873d6e65.js"><link rel="prefetch" href="/assets/js/page-输入和输出.e5035cdc.js"><link rel="prefetch" href="/assets/js/page-返回函数.db6c3912.js"><link rel="prefetch" href="/assets/js/page-进阶.87979fe7.js"><link rel="prefetch" href="/assets/js/page-远程仓库.ae529eed.js"><link rel="prefetch" href="/assets/js/page-迭代.a187948a.js"><link rel="prefetch" href="/assets/js/page-迭代器.cbc05534.js"><link rel="prefetch" href="/assets/js/page-选择器.4a534973.js"><link rel="prefetch" href="/assets/js/page-递归函数.59265bcc.js"><link rel="prefetch" href="/assets/js/page-面试题.49e56935.js"><link rel="prefetch" href="/assets/js/page-高阶函数.f2ace53f.js">
    <link rel="stylesheet" href="/assets/css/0.styles.fba0a66d.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><span class="icon"></span></div> <a href="/" class="home-link router-link-active"><img src="/logo3.png" alt="Harry Xiong" class="logo"> <!----> <span class="site-name can-hide">Harry Xiong</span></a> <div class="links"><div class="color-picker"><span class="color-button"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="skin-icon"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4
        38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32
        51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0
        102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2
        6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4
        0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2
        9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224
        419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4
        470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0
        22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6
        12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128
        505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2
        16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8
        86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4
        80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6
        6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg></span> <div class="color-picker-menu" style="display:none;"><div class="theme-options"><ul class="themecolor-select"><label for="themecolor-select">主题色:</label> <li><a href="#" class="default-theme"></a></li> </ul> <div class="darkmode-toggle"><label for="darkmode-toggle" class="desc">主题模式:</label> <div class="darkmode-switch" data-v-5c9e06c7><div class="item day" data-v-5c9e06c7><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon light-icon" data-v-5c9e06c7><path d="M512 256a42.666667 42.666667 0 0 0 42.666667-42.666667V128a42.666667 42.666667 0 0 0-85.333334
    0v85.333333a42.666667 42.666667 0 0 0 42.666667 42.666667zM896 469.333333h-85.333333a42.666667
    42.666667 0 0 0 0 85.333334h85.333333a42.666667 42.666667 0 0 0 0-85.333334zM256 512a42.666667
    42.666667 0 0 0-42.666667-42.666667H128a42.666667 42.666667 0 0 0 0 85.333334h85.333333a42.666667
    42.666667 0 0 0 42.666667-42.666667zM265.386667 213.333333a42.666667 42.666667 0 0 0-59.306667
    62.72l61.44 59.306667a42.666667 42.666667 0 0 0 31.146667 11.946667 42.666667 42.666667 0 0 0
    30.72-13.226667 42.666667 42.666667 0 0 0 0-60.16zM725.333333 347.306667a42.666667 42.666667 0 0 0
    29.44-11.946667l61.44-59.306667A42.666667 42.666667 0 0 0 758.613333 213.333333l-61.44
    60.586667a42.666667 42.666667 0 0 0 0 60.16 42.666667 42.666667 0 0 0 28.16 13.226667zM512
    768a42.666667 42.666667 0 0 0-42.666667 42.666667v85.333333a42.666667 42.666667 0 0 0 85.333334
    0v-85.333333a42.666667 42.666667 0 0 0-42.666667-42.666667zM756.48 688.64a42.666667 42.666667 0 0
    0-59.306667 61.44L758.613333 810.666667a42.666667 42.666667 0 0 0 29.44 11.946666 42.666667 42.666667
    0 0 0 30.72-12.8 42.666667 42.666667 0 0 0 0-60.586666zM267.52 688.64l-61.44 59.306667a42.666667
    42.666667 0 0 0 0 60.586666 42.666667 42.666667 0 0 0 30.72 12.8 42.666667 42.666667 0 0 0
    28.586667-10.666666l61.44-59.306667a42.666667 42.666667 0 0 0-59.306667-61.44zM512 341.333333a170.666667
    170.666667 0 1 0 170.666667 170.666667 170.666667 170.666667 0 0 0-170.666667-170.666667z" fill="currentColor"></path></svg></div> <div class="item auto active" data-v-5c9e06c7><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" data-v-5c9e06c7><path d="M460.864 539.072h103.936l-54.208-163.072-49.728 163.072z m411.136-176.704V149.504h-212.352L510.528
    0l-149.12 149.504H149.12v212.928L0 511.872l149.12 149.504v212.928h212.352l149.12 149.504
    149.12-149.504h212.352v-212.928l149.12-149.504-149.184-149.504zM614.464 693.12l-31.616-90.624H438.272l-31.616
    90.624H320.768l144.576-407.68h90.368l144.576 407.68H614.464z m0 0" fill="currentColor"></path></svg></div> <div class="item night" data-v-5c9e06c7><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" data-v-5c9e06c7><path d="M935.538601 630.40178c-11.43005-11.432249-28.673759-14.738607-43.531086-8.353536-46.733115 20.10317-96.362866 30.296859-147.50719 30.296859-99.589478 0-193.221796-38.783705-263.640252-109.20316-108.636744-108.636744-139.609745-270.022125-78.9083-411.148441 6.388069-14.85233 3.078713-32.098837-8.353536-43.532285-11.432249-11.432249-28.675758-14.743604-43.532285-8.354536-52.637312 22.64025-100.017388 54.809439-140.82552 95.616372-85.346135 85.346135-132.346869 198.821199-132.346869 319.519766 0 120.699566 47.001733 234.172631 132.347868 319.518766s198.821199 132.349067 319.517567 132.349067c120.699566 0 234.172431-47.002932 319.520765-132.351066 40.808132-40.810131 72.977122-88.190207 95.615373-140.82552C950.282205 659.081735 946.971849 641.834029 935.538601 630.40178z" fill="currentColor"></path></svg></div></div> <!----></div></div></div></div> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont icon-homefill"></i>
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="随笔" class="dropdown-title"><span class="title"><i class="iconfont icon-note"></i>
      随笔
    </span> <span class="arrow down"></span></button> <button type="button" aria-label="随笔" class="mobile-dropdown-title"><span class="title"><i class="iconfont icon-note"></i>
      随笔
    </span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/poem/" class="nav-link"><!---->
  写在前面
</a></li><li class="dropdown-item"><h4>诗集</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/poem/life/" class="nav-link"><i class="iconfont icon-likefill"></i>
  生命之歌
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="web前端" class="dropdown-title"><span class="title"><i class="iconfont icon-code"></i>
      web前端
    </span> <span class="arrow down"></span></button> <button type="button" aria-label="web前端" class="mobile-dropdown-title"><span class="title"><i class="iconfont icon-code"></i>
      web前端
    </span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/FrontEnd/" class="nav-link router-link-active"><!---->
  前端总述
</a></li><li class="dropdown-item"><h4>Basic</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/FrontEnd/htmlcss/html.html" class="nav-link"><i class="iconfont icon-html"></i>
  HTML5&amp;CSS&amp;HTML进阶
</a></li><li class="dropdown-subitem"><a href="/FrontEnd/preCSS/sass.html" class="nav-link"><i class="iconfont icon-css"></i>
  Less&amp;Sass&amp;Bootstrap
</a></li><li class="dropdown-subitem"><a href="/FrontEnd/jses/js/" class="nav-link"><i class="iconfont icon-js"></i>
  JavaScript
</a></li><li class="dropdown-subitem"><a href="/FrontEnd/jses/es6/" class="nav-link"><i class="iconfont icon-es6"></i>
  ES6
</a></li><li class="dropdown-subitem"><a href="/FrontEnd/DomBom/" class="nav-link"><i class="iconfont icon-nodeJS"></i>
  DOM&amp;BOM
</a></li></ul></li><li class="dropdown-item"><h4>General</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/FrontEnd/ajax/Ajax.html" class="nav-link"><i class="iconfont icon-ajax"></i>
  Ajax
</a></li><li class="dropdown-subitem"><a href="/FrontEnd/dataStorage/dataStorage.html" class="nav-link"><i class="iconfont icon-infofill"></i>
  DataStorage
</a></li><li class="dropdown-subitem"><a href="/FrontEnd/webpack/webpack.html" class="nav-link"><i class="iconfont icon-file"></i>
  Webpack
</a></li></ul></li><li class="dropdown-item"><h4>Freewill</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/FrontEnd/advancedJS/" class="nav-link"><i class="iconfont icon-js"></i>
  JS-E6进阶
</a></li><li class="dropdown-subitem"><a href="/FrontEnd/typescript/" class="nav-link"><i class="iconfont icon-typescript"></i>
  TypeScript
</a></li><li class="dropdown-subitem"><a href="/FrontEnd/Vue/" class="nav-link router-link-active"><i class="iconfont icon-vue"></i>
  Vue
</a></li><li class="dropdown-subitem"><a href="/FrontEnd/jQuery/" class="nav-link"><i class="iconfont icon-jQuery"></i>
  jQuery
</a></li></ul></li><li class="dropdown-item"><h4>In-depth</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/FrontEnd/indepth/Browser.html" class="nav-link"><i class="iconfont icon-chrome"></i>
  浏览器渲染原理与性能优化
</a></li><li class="dropdown-subitem"><a href="/FrontEnd/VirtualDom/" class="nav-link"><i class="iconfont icon-app"></i>
  虚拟DOM与Diff算法
</a></li><li class="dropdown-subitem"><a href="/FrontEnd/indepth/https.html" class="nav-link"><i class="iconfont icon-link"></i>
  Http与Https
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Web后台" class="dropdown-title"><span class="title"><i class="iconfont icon-backstage"></i>
      Web后台
    </span> <span class="arrow down"></span></button> <button type="button" aria-label="Web后台" class="mobile-dropdown-title"><span class="title"><i class="iconfont icon-backstage"></i>
      Web后台
    </span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/BackEnd/" class="nav-link"><!---->
  后台总述
</a></li><li class="dropdown-item"><h4>NodeJS搭建后台</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/tip.html" class="nav-link"><!---->
  NodeJS
</a></li><li class="dropdown-subitem"><a href="/tip.html" class="nav-link"><!---->
  MongoDB
</a></li><li class="dropdown-subitem"><a href="/tip.html" class="nav-link"><!---->
  Koa
</a></li><li class="dropdown-subitem"><a href="/BackEnd/express/express.html" class="nav-link"><!---->
  Express
</a></li></ul></li><li class="dropdown-item"><h4>Servlet专栏</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/BackEnd/Servlet/" class="nav-link"><!---->
  Servlet&amp;JSP
</a></li></ul></li><li class="dropdown-item"><h4>Python专栏</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/BackEnd/python/" class="nav-link"><!---->
  Python
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="IT知识" class="dropdown-title"><span class="title"><i class="iconfont icon-computer"></i>
      IT知识
    </span> <span class="arrow down"></span></button> <button type="button" aria-label="IT知识" class="mobile-dropdown-title"><span class="title"><i class="iconfont icon-computer"></i>
      IT知识
    </span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/computer/basic/" class="nav-link"><i class="iconfont icon-file"></i>
  计算机基础
</a></li><li class="dropdown-item"><!----> <a href="/computer/Markdown/Markdown.html" class="nav-link"><i class="iconfont icon-markdown"></i>
  Markdown
</a></li><li class="dropdown-item"><!----> <a href="/computer/InformationSecurity/InformationSecurity.html" class="nav-link"><i class="iconfont icon-infofill"></i>
  信息安全理论与技术
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="常用工具" class="dropdown-title"><span class="title"><i class="iconfont icon-software"></i>
      常用软件
    </span> <span class="arrow down"></span></button> <button type="button" aria-label="常用工具" class="mobile-dropdown-title"><span class="title"><i class="iconfont icon-software"></i>
      常用软件
    </span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/tools/git/" class="nav-link"><i class="iconfont icon-git"></i>
  Git
</a></li><li class="dropdown-item"><!----> <a href="/tools/vscode/" class="nav-link"><i class="iconfont icon-vscode"></i>
  VSCode
</a></li><li class="dropdown-item"><!----> <a href="/tools/windows/" class="nav-link"><i class="iconfont icon-windows"></i>
  Windows
</a></li><li class="dropdown-item"><!----> <a href="/tools/linux/" class="nav-link"><i class="iconfont icon-app"></i>
  Linux
</a></li><li class="dropdown-item"><!----> <a href="/tools/apache/apache.html" class="nav-link"><i class="iconfont icon-Apache"></i>
  Apache
</a></li><li class="dropdown-item"><!----> <a href="/tools/nginx/nginx.html" class="nav-link"><i class="iconfont icon-nginx"></i>
  Nginx
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><span class="title"><!---->
      更多
    </span> <span class="arrow down"></span></button> <button type="button" aria-label="更多" class="mobile-dropdown-title"><span class="title"><!---->
      更多
    </span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/notice/T12.html" class="nav-link"><!---->
  公告
</a></li><li class="dropdown-item"><!----> <a href="/more/friend.html" class="nav-link"><!---->
  站友推荐
</a></li><li class="dropdown-item"><!----> <a href="/profile/info.html" class="nav-link"><!---->
  Harry自述
</a></li><li class="dropdown-item"><!----> <a href="/profile/contact.html" class="nav-link"><!---->
  联系Harry
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title"><!---->
      选择语言
    </span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title"><!---->
      选择语言
    </span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/en/" class="nav-link"><!---->
  English
</a></li><li class="dropdown-item"><!----> <a href="/FrontEnd/Vue/vue18/" aria-current="page" class="nav-link router-link-exact-active router-link-active"><!---->
  简体中文
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><div class="blogger-info mobile"><div class="blogger-wrapper"><div class="blogger hasIntro"><img alt="blogger-avatar" src="/logo3.png" class="avatar"> <div class="name">Harry Xiong</div></div></div> <div class="num-wrapper"><div><div>文章</div> <div class="num">298</div></div> <div><div>分类</div> <div class="num">14</div></div> <div><div>标签</div> <div class="num">62</div></div></div></div> <hr>  <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont icon-homefill"></i>
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="随笔" class="dropdown-title"><span class="title"><i class="iconfont icon-note"></i>
      随笔
    </span> <span class="arrow down"></span></button> <button type="button" aria-label="随笔" class="mobile-dropdown-title"><span class="title"><i class="iconfont icon-note"></i>
      随笔
    </span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/poem/" class="nav-link"><!---->
  写在前面
</a></li><li class="dropdown-item"><h4>诗集</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/poem/life/" class="nav-link"><i class="iconfont icon-likefill"></i>
  生命之歌
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="web前端" class="dropdown-title"><span class="title"><i class="iconfont icon-code"></i>
      web前端
    </span> <span class="arrow down"></span></button> <button type="button" aria-label="web前端" class="mobile-dropdown-title"><span class="title"><i class="iconfont icon-code"></i>
      web前端
    </span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/FrontEnd/" class="nav-link router-link-active"><!---->
  前端总述
</a></li><li class="dropdown-item"><h4>Basic</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/FrontEnd/htmlcss/html.html" class="nav-link"><i class="iconfont icon-html"></i>
  HTML5&amp;CSS&amp;HTML进阶
</a></li><li class="dropdown-subitem"><a href="/FrontEnd/preCSS/sass.html" class="nav-link"><i class="iconfont icon-css"></i>
  Less&amp;Sass&amp;Bootstrap
</a></li><li class="dropdown-subitem"><a href="/FrontEnd/jses/js/" class="nav-link"><i class="iconfont icon-js"></i>
  JavaScript
</a></li><li class="dropdown-subitem"><a href="/FrontEnd/jses/es6/" class="nav-link"><i class="iconfont icon-es6"></i>
  ES6
</a></li><li class="dropdown-subitem"><a href="/FrontEnd/DomBom/" class="nav-link"><i class="iconfont icon-nodeJS"></i>
  DOM&amp;BOM
</a></li></ul></li><li class="dropdown-item"><h4>General</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/FrontEnd/ajax/Ajax.html" class="nav-link"><i class="iconfont icon-ajax"></i>
  Ajax
</a></li><li class="dropdown-subitem"><a href="/FrontEnd/dataStorage/dataStorage.html" class="nav-link"><i class="iconfont icon-infofill"></i>
  DataStorage
</a></li><li class="dropdown-subitem"><a href="/FrontEnd/webpack/webpack.html" class="nav-link"><i class="iconfont icon-file"></i>
  Webpack
</a></li></ul></li><li class="dropdown-item"><h4>Freewill</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/FrontEnd/advancedJS/" class="nav-link"><i class="iconfont icon-js"></i>
  JS-E6进阶
</a></li><li class="dropdown-subitem"><a href="/FrontEnd/typescript/" class="nav-link"><i class="iconfont icon-typescript"></i>
  TypeScript
</a></li><li class="dropdown-subitem"><a href="/FrontEnd/Vue/" class="nav-link router-link-active"><i class="iconfont icon-vue"></i>
  Vue
</a></li><li class="dropdown-subitem"><a href="/FrontEnd/jQuery/" class="nav-link"><i class="iconfont icon-jQuery"></i>
  jQuery
</a></li></ul></li><li class="dropdown-item"><h4>In-depth</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/FrontEnd/indepth/Browser.html" class="nav-link"><i class="iconfont icon-chrome"></i>
  浏览器渲染原理与性能优化
</a></li><li class="dropdown-subitem"><a href="/FrontEnd/VirtualDom/" class="nav-link"><i class="iconfont icon-app"></i>
  虚拟DOM与Diff算法
</a></li><li class="dropdown-subitem"><a href="/FrontEnd/indepth/https.html" class="nav-link"><i class="iconfont icon-link"></i>
  Http与Https
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Web后台" class="dropdown-title"><span class="title"><i class="iconfont icon-backstage"></i>
      Web后台
    </span> <span class="arrow down"></span></button> <button type="button" aria-label="Web后台" class="mobile-dropdown-title"><span class="title"><i class="iconfont icon-backstage"></i>
      Web后台
    </span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/BackEnd/" class="nav-link"><!---->
  后台总述
</a></li><li class="dropdown-item"><h4>NodeJS搭建后台</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/tip.html" class="nav-link"><!---->
  NodeJS
</a></li><li class="dropdown-subitem"><a href="/tip.html" class="nav-link"><!---->
  MongoDB
</a></li><li class="dropdown-subitem"><a href="/tip.html" class="nav-link"><!---->
  Koa
</a></li><li class="dropdown-subitem"><a href="/BackEnd/express/express.html" class="nav-link"><!---->
  Express
</a></li></ul></li><li class="dropdown-item"><h4>Servlet专栏</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/BackEnd/Servlet/" class="nav-link"><!---->
  Servlet&amp;JSP
</a></li></ul></li><li class="dropdown-item"><h4>Python专栏</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/BackEnd/python/" class="nav-link"><!---->
  Python
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="IT知识" class="dropdown-title"><span class="title"><i class="iconfont icon-computer"></i>
      IT知识
    </span> <span class="arrow down"></span></button> <button type="button" aria-label="IT知识" class="mobile-dropdown-title"><span class="title"><i class="iconfont icon-computer"></i>
      IT知识
    </span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/computer/basic/" class="nav-link"><i class="iconfont icon-file"></i>
  计算机基础
</a></li><li class="dropdown-item"><!----> <a href="/computer/Markdown/Markdown.html" class="nav-link"><i class="iconfont icon-markdown"></i>
  Markdown
</a></li><li class="dropdown-item"><!----> <a href="/computer/InformationSecurity/InformationSecurity.html" class="nav-link"><i class="iconfont icon-infofill"></i>
  信息安全理论与技术
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="常用工具" class="dropdown-title"><span class="title"><i class="iconfont icon-software"></i>
      常用软件
    </span> <span class="arrow down"></span></button> <button type="button" aria-label="常用工具" class="mobile-dropdown-title"><span class="title"><i class="iconfont icon-software"></i>
      常用软件
    </span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/tools/git/" class="nav-link"><i class="iconfont icon-git"></i>
  Git
</a></li><li class="dropdown-item"><!----> <a href="/tools/vscode/" class="nav-link"><i class="iconfont icon-vscode"></i>
  VSCode
</a></li><li class="dropdown-item"><!----> <a href="/tools/windows/" class="nav-link"><i class="iconfont icon-windows"></i>
  Windows
</a></li><li class="dropdown-item"><!----> <a href="/tools/linux/" class="nav-link"><i class="iconfont icon-app"></i>
  Linux
</a></li><li class="dropdown-item"><!----> <a href="/tools/apache/apache.html" class="nav-link"><i class="iconfont icon-Apache"></i>
  Apache
</a></li><li class="dropdown-item"><!----> <a href="/tools/nginx/nginx.html" class="nav-link"><i class="iconfont icon-nginx"></i>
  Nginx
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><span class="title"><!---->
      更多
    </span> <span class="arrow down"></span></button> <button type="button" aria-label="更多" class="mobile-dropdown-title"><span class="title"><!---->
      更多
    </span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/notice/T12.html" class="nav-link"><!---->
  公告
</a></li><li class="dropdown-item"><!----> <a href="/more/friend.html" class="nav-link"><!---->
  站友推荐
</a></li><li class="dropdown-item"><!----> <a href="/profile/info.html" class="nav-link"><!---->
  Harry自述
</a></li><li class="dropdown-item"><!----> <a href="/profile/contact.html" class="nav-link"><!---->
  联系Harry
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title"><!---->
      选择语言
    </span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title"><!---->
      选择语言
    </span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/en/" class="nav-link"><!---->
  English
</a></li><li class="dropdown-item"><!----> <a href="/FrontEnd/Vue/vue18/" aria-current="page" class="nav-link router-link-exact-active router-link-active"><!---->
  简体中文
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><i class="iconfont icon-vue"></i> <span>Vue</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/FrontEnd/Vue/" aria-current="page" class="sidebar-link"><i class="iconfont icon-vue" style="margin-right:0.2em;"></i>Vue</a></li><li><a href="/FrontEnd/Vue/vue1/" class="sidebar-link"><i class="iconfont icon-vue" style="margin-right:0.2em;"></i>1.Vue简介</a></li><li><a href="/FrontEnd/Vue/vue2/" class="sidebar-link"><i class="iconfont icon-vue" style="margin-right:0.2em;"></i>2.Vue实例对象</a></li><li><a href="/FrontEnd/Vue/vue3/" class="sidebar-link"><i class="iconfont icon-vue" style="margin-right:0.2em;"></i>3.基本指令</a></li><li><a href="/FrontEnd/Vue/vue4/" class="sidebar-link"><i class="iconfont icon-vue" style="margin-right:0.2em;"></i>4.计算属性与监视</a></li><li><a href="/FrontEnd/Vue/vue5/" class="sidebar-link"><i class="iconfont icon-vue" style="margin-right:0.2em;"></i>5.绑定class和style</a></li><li><a href="/FrontEnd/Vue/vue6/" class="sidebar-link"><i class="iconfont icon-vue" style="margin-right:0.2em;"></i>6.Vue基本操作</a></li><li><a href="/FrontEnd/Vue/vue7/" class="sidebar-link"><i class="iconfont icon-vue" style="margin-right:0.2em;"></i>7.按键修饰符</a></li><li><a href="/FrontEnd/Vue/vue8/" class="sidebar-link"><i class="iconfont icon-vue" style="margin-right:0.2em;"></i>8.Vue的生命周期</a></li><li><a href="/FrontEnd/Vue/vue9/" class="sidebar-link"><i class="iconfont icon-vue" style="margin-right:0.2em;"></i>9.过渡与动画</a></li><li><a href="/FrontEnd/Vue/vue10/" class="sidebar-link"><i class="iconfont icon-vue" style="margin-right:0.2em;"></i>10.过滤器</a></li><li><a href="/FrontEnd/Vue/vue11/" class="sidebar-link"><i class="iconfont icon-vue" style="margin-right:0.2em;"></i>11.自定义指令</a></li><li><a href="/FrontEnd/Vue/vue12/" class="sidebar-link"><i class="iconfont icon-vue" style="margin-right:0.2em;"></i>12.组件</a></li><li><a href="/FrontEnd/Vue/vue13/" class="sidebar-link"><i class="iconfont icon-vue" style="margin-right:0.2em;"></i>13.组件之间的通信方式</a></li><li><a href="/FrontEnd/Vue/vue14/" class="sidebar-link"><i class="iconfont icon-vue" style="margin-right:0.2em;"></i>14.Vue-Router</a></li><li><a href="/FrontEnd/Vue/vue15/" class="sidebar-link"><i class="iconfont icon-vue" style="margin-right:0.2em;"></i>15.Vuex</a></li><li><a href="/FrontEnd/Vue/vue16/" class="sidebar-link"><i class="iconfont icon-vue" style="margin-right:0.2em;"></i>16.对象数组更新</a></li><li><a href="/FrontEnd/Vue/vue17/" class="sidebar-link"><i class="iconfont icon-vue" style="margin-right:0.2em;"></i>17.Mixins</a></li><li><a href="/FrontEnd/Vue/vue18/" aria-current="page" class="active sidebar-link"><i class="iconfont icon-vue" style="margin-right:0.2em;"></i>18.Vue原码分析</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/FrontEnd/Vue/vue18/#vue-原码分析" class="sidebar-link">Vue 原码分析</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/FrontEnd/Vue/vue18/#_18-1-准备知识" class="sidebar-link">18.1 准备知识</a></li><li class="sidebar-sub-header"><a href="/FrontEnd/Vue/vue18/#_18-2-数据代理" class="sidebar-link">18.2 数据代理</a></li><li class="sidebar-sub-header"><a href="/FrontEnd/Vue/vue18/#_18-3-模板解析" class="sidebar-link">18.3 模板解析</a></li><li class="sidebar-sub-header"><a href="/FrontEnd/Vue/vue18/#_18-4-数据绑定" class="sidebar-link">18.4 数据绑定</a></li><li class="sidebar-sub-header"><a href="/FrontEnd/Vue/vue18/#_18-5-数据驱动" class="sidebar-link">18.5 数据驱动</a></li><li class="sidebar-sub-header"><a href="/FrontEnd/Vue/vue18/#_18-6-函数科里化和渲染模型" class="sidebar-link">18.6 函数科里化和渲染模型</a></li><li class="sidebar-sub-header"><a href="/FrontEnd/Vue/vue18/#_18-7-响应式原理" class="sidebar-link">18.7 响应式原理</a></li><li class="sidebar-sub-header"><a href="/FrontEnd/Vue/vue18/#_18-8-发布订阅模式" class="sidebar-link">18.8 发布订阅模式</a></li><li class="sidebar-sub-header"><a href="/FrontEnd/Vue/vue18/#_18-9-flow" class="sidebar-link">18.9 Flow</a></li><li class="sidebar-sub-header"><a href="/FrontEnd/Vue/vue18/#_18-10-vue-的-mvvm-模式" class="sidebar-link">18.10 Vue 的 MVVM 模式</a></li></ul></li></ul></li></ul></section></li></ul> </aside> <main class="page"><nav class="breadcrumb"><ul><li><a class="iconfont icon-infofill">大前端学习路线</a></li><li><a class="iconfont icon-vue">Vue</a></li><li class="is-active"><a class="iconfont icon-vue">18.Vue原码分析</a></li></ul></nav>  <div class="page-title"><h1>18.Vue原码分析</h1> <div class="page-info"><span><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon author-icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8
        57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8
        22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z" fill="currentColor"></path></svg> <span>Harry Xiong</span></span><span class="visitor-info"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon eye-icon"><path d="M992 512.096c0-5.76-0.992-10.592-1.28-11.136-0.192-2.88-1.152-8.064-2.08-10.816-0.256-0.672-0.544-1.376-0.832-2.08-0.48-1.568-1.024-3.104-1.6-4.32C897.664 290.112 707.104 160 512 160 316.928 160 126.368
          290.016 38.24 482.592c-1.056 2.112-1.792 4.096-2.272 5.856-0.224 0.544-0.448 1.088-0.64
          1.6-1.76 5.088-1.792 8.64-1.632 7.744-0.832 3.744-1.568 11.168-1.568 11.168-0.224 2.272-0.224
          4.032 0.032 6.304 0 0 0.736 6.464 1.088 7.808 0.128 1.824 0.576 4.512 1.12 6.976l-0.032 0c0.448
          2.08 1.12 4.096 1.984 6.08 0.48 1.536 0.992 2.976 1.472 4.032C126.432 733.856 316.992 864 512
          864c195.136 0 385.696-130.048 473.216-321.696 1.376-2.496 2.24-4.832 2.848-6.912 0.256-0.608
          0.48-1.184 0.672-1.728 1.536-4.48 1.856-8.32 1.728-8.32 0 0 0 0-0.032 0.032C991.04 522.272 992
          517.632 992 512.096zM512 672c-88.224 0-160-71.776-160-160s71.776-160 160-160 160 71.776 160
          160S600.224 672 512 672z" fill="currentColor"></path></svg> <span id="/FrontEnd/Vue/vue18/" data-flag-title="18.Vue原码分析" class="leancloud_visitors"><span class="leancloud-visitors-count">...</span></span></span><span class="time-info"><svg viewBox="0 0 1030 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon"><path d="M716.40077995 110.13681607c0-18.75236523-14.72060643-33.47297166-33.47297166-33.47297166-18.75236523 0-33.47297166 14.72060643-33.47297167 33.47297166v33.47297166h66.99282432v-33.47297166zM381.5304192 110.13681607c0-18.75236523-14.72060643-33.47297166-33.47297166-33.47297166s-33.51985266 14.72060643-33.51985266 33.47297166v33.47297166h66.99282432v-33.47297166zM850.33954759 143.65666873h-133.93876764v100.46579598c0 18.75236523-14.72060643 33.47297166-33.47297166 33.47297166a33.14480583 33.14480583 0 0 1-33.47297167-33.47297166V143.65666873H381.5304192v100.46579598c0 18.75236523-14.72060643 33.47297166-33.47297166 33.47297166a33.14480583 33.14480583 0 0 1-33.47297167-33.47297166V143.65666873H180.59882723A134.31381561 134.31381561 0 0 0 46.66005959 277.59543637v535.75507058a134.31381561 134.31381561 0 0 0 133.93876764 133.93876878h669.74072036a134.36069547 134.36069547 0 0 0 133.93876764-133.93876878V277.59543637a134.31381561 134.31381561 0 0 0-133.93876764-133.93876764z m33.47297166 267.87753529H147.12585557a33.14480583 33.14480583 0 0 1-33.47297166-33.47297167c0-18.75236523 14.72060643-33.47297166 33.47297166-33.47297166h736.68666368c18.75236523 0 33.47297166 14.72060643 33.47297166 33.47297166a33.14480583 33.14480583 0 0 1-33.47297166 33.47297167z" fill="currentColor"></path></svg> <span>2020-6-18</span></span><span class="category-info active"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon category-icon"><path d="M148.410098 106.99178l282.175661 0c22.26305 0 40.311101 18.048051 40.311101 40.311101l0
    282.175661c0 22.26305-18.048051 40.311101-40.311101 40.311101L148.410098 469.789643c-22.26305
    0-40.311101-18.048051-40.311101-40.311101L108.098997 147.301857C108.098997 125.038808 126.147048
    106.99178 148.410098 106.99178z" fill="currentColor"></path> <path d="M147.555637 553.47767 429.731298 553.47767c22.26305 0 40.311101 18.048051 40.311101 40.311101l0
    282.175661c0 22.26305-18.048051 40.311101-40.311101 40.311101L147.555637 916.275533c-22.26305
    0-40.311101-18.048051-40.311101-40.311101L107.244536 593.788771C107.24556 571.525722 125.292588
    553.47767 147.555637 553.47767z" fill="currentColor"></path> <path d="M593.926918 106.99178l282.175661 0c22.26305 0 40.311101 18.048051 40.311101 40.311101l0
    282.175661c0 22.26305-18.048051 40.311101-40.311101 40.311101L593.926918 469.789643c-22.26305
    0-40.311101-18.048051-40.311101-40.311101L553.615816 147.301857C553.615816 125.038808 571.663868
    106.99178 593.926918 106.99178z" fill="currentColor"></path> <path d="M730.220047 920.501788 623.926162 920.501788c-40.925085 0-74.220399-33.387411-74.220399-74.42506L549.705763 623.991654c0-41.037648 33.387411-74.424037 74.42506-74.424037l222.085074 0c41.037648
    0 74.424037 33.226752 74.424037 74.066903L920.639934 737.868237c0 10.243295-8.30413
    18.547425-18.547425 18.547425s-18.547425-8.30413-18.547425-18.547425L883.545084
    623.63452c0-20.387329-16.746406-36.973076-37.33021-36.973076L624.130823 586.661444c-20.584827
    0-37.331233 16.746406-37.331233 37.33021l0 222.085074c0 20.584827 16.654308 37.331233 37.126572
    37.331233l106.293885 0c10.243295 0 18.547425 8.30413 18.547425 18.547425C748.766448 912.198681
    740.463342 920.501788 730.220047 920.501788z" fill="currentColor"></path></svg> <span>Web前端</span></span><span><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon tag-icon"><path d="M939.90178584 458.5625l-29.73214336-313.99553584c-1.50669667-16.27232168-14.46428584-29.12946416-30.73660664-30.73660664L565.4375 84.09821416h-0.40178584c-3.21428584 0-5.72544668 1.00446416-7.63392832 2.91294668L87.01116084
    557.40178584a10.00446416 10.00446416 0 0 0 0 14.16294668l365.42410664 365.42410664c1.90848252
    1.90848252 4.41964248 2.91294667 7.13169668 2.91294668s5.22321416-1.00446416
    7.13169668-2.91294668l470.390625-470.390625c2.00892833-2.109375 3.01339248-5.02232168
    2.8125-8.03571416zM699.83482168 386.44196416c-35.45758916
    0-64.28571416-28.828125-64.28571416-64.28571416s28.828125-64.28571416 64.28571416-64.28571416
    64.28571416 28.828125 64.28571416 64.28571416-28.828125 64.28571416-64.28571417 64.28571416z" fill="currentColor"></path></svg> <ul class="tags-wrapper"><li class="tag clickable tag0">Vue</li><li class="tag clickable tag1">MVVM</li><li class="tag clickable tag2">Vuex</li><li class="tag clickable tag3">Vue-router</li><li class="tag clickable tag4">Vue源码分析</li></ul></span><span class="read-time-info"><svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" class="icon time-icon"><path d="M511.99730176 70.56849042c-243.79770498 0-441.42881133 197.63290459-441.42881133 441.43420783 0 243.79770498 197.63110635 441.42881133 441.42881133 441.42881132s441.43420781-197.63110635 441.43420781-441.42881133C953.43150958 268.20589238 755.79500674 70.56849042 511.99730176 70.56849042L511.99730176 70.56849042zM662.15499453 679.66072578l-15.60531972 15.60981623c-8.62065527 8.61525878-22.59538066 8.61525878-31.21513594-2e-8L472.19658682 552.12629434c-4.95024346-4.94394786-4.33955742-14.88850576-4.33955742-24.67746827L467.85702852 247.14037461c0-12.18943565 9.8816001-22.07013662 22.07013661-22.07013662l22.07013663 0c12.18943565 0 22.07013662 9.8816001 22.07013662 22.07013662l0 273.2176582 128.08755703 128.08755704C670.77564981 657.06534599 670.77564981 671.04097051 662.15499453 679.66072578L662.15499453 679.66072578zM662.15499453 679.66072578" fill="currentColor"></path></svg> <span>大约 28 分钟</span></span></div></div> <!----> <div class="theme-default-content content__default"><h2 id="vue-原码分析"><a href="#vue-原码分析" class="header-anchor">#</a> Vue 原码分析</h2> <h3 id="_18-1-准备知识"><a href="#_18-1-准备知识" class="header-anchor">#</a> 18.1 准备知识</h3> <ol><li><p>[].slice.call(lis): 将伪数组转换为真数组</p></li> <li><p>node.nodeType: 得到节点类型</p></li> <li><p>Object.defineProperty(obj, propName, {}): 给对象添加/修改属性(指定描述符) configurable: true/false 是否可以重新 define</p></li></ol> <p>enumerable: true/false 是否可以枚举(for..in / keys())</p> <p>value: 指定初始值 writable: true/false value 是否可以修改</p> <p>get: 回调函数, 用来得到当前属性值</p> <p>set: 回调函数, 用来监视当前属性值的变化</p> <ol start="4"><li><p>Object.keys(obj): 得到对象自身可枚举的属性名的数组</p></li> <li><p>DocumentFragment: 文档碎片(高效批量更新多个节点)</p></li> <li><p>obj.hasOwnProperty(prop): 判断 prop 是否是 obj 自身的属性</p></li></ol> <h3 id="_18-2-数据代理"><a href="#_18-2-数据代理" class="header-anchor">#</a> 18.2 数据代理</h3> <ol><li><p>数据代理: 通过一个对象代理对另一个对象(在前一个对象内部)中属性的操作(读/写)</p></li> <li><p>vue 数据代理: 通过 vm 对象来代理 data 对象中所有属性的操作</p></li> <li><p>好处: 更方便的操作 data 中的数据</p></li> <li><p>基本实现流程</p></li></ol> <p>a. 通过 Object.defineProperty()给 vm 添加与 data 对象的属性对应的属性描述符</p> <p>b. 所有添加的属性都包含 getter/setter</p> <p>c. getter/setter 内部去操作 data</p> <h3 id="_18-3-模板解析"><a href="#_18-3-模板解析" class="header-anchor">#</a> 18.3 模板解析</h3> <h4 id="_18-3-1-模板解析的基本流程"><a href="#_18-3-1-模板解析的基本流程" class="header-anchor">#</a> 18.3.1 模板解析的基本流程</h4> <ol><li><p>将 el 的所有子节点取出, 添加到一个新建的文档 fragment 对象中</p></li> <li><p>对 fragment 中的所有层次子节点递归进行编译解析处理</p></li></ol> <p>* 对大括号表达式文本节点进行解析</p> <p>* 对元素节点的指令属性进行解析</p> <p>* 事件指令解析</p> <p>* 一般指令解析</p> <ol start="3"><li>将解析后的 fragment 添加到 el 中显示</li></ol> <h4 id="_18-3-2-大括号表达式解析"><a href="#_18-3-2-大括号表达式解析" class="header-anchor">#</a> 18.3.2 大括号表达式解析</h4> <ol><li><p>根据正则对象得到匹配出的表达式字符串: 子匹配/RegExp.$1 name</p></li> <li><p>从 data 中取出表达式对应的属性值</p></li> <li><p>将属性值设置为文本节点的 textContent</p></li></ol> <p>####18.3.3 事件指令解析</p> <ol><li><p>从指令名中取出事件名</p></li> <li><p>根据指令的值(表达式)从 methods 中得到对应的事件处理函数对象</p></li> <li><p>给当前元素节点绑定指定事件名和回调函数的 dom 事件监听</p></li> <li><p>指令解析完后, 移除此指令属性</p></li></ol> <h4 id="_18-3-4-一般指令解析"><a href="#_18-3-4-一般指令解析" class="header-anchor">#</a> 18.3.4 一般指令解析</h4> <ol><li><p>得到指令名和指令值(表达式) text/html/class msg/myClass</p></li> <li><p>从 data 中根据表达式得到对应的值</p></li> <li><p>根据指令名确定需要操作元素节点的什么属性 _ v-text---textContent 属性 _ v-html---innerHTML 属性 * v-class--className 属性</p></li> <li><p>将得到的表达式的值设置到对应的属性上</p></li> <li><p>移除元素的指令属性</p></li></ol> <h3 id="_18-4-数据绑定"><a href="#_18-4-数据绑定" class="header-anchor">#</a> 18.4 数据绑定</h3> <h4 id="_18-4-1-数据绑定效果"><a href="#_18-4-1-数据绑定效果" class="header-anchor">#</a> 18.4.1 数据绑定效果</h4> <p>一旦更新了 data 中的某个属性数据, 所有界面上直接使用或间接使用了此属性的节点都会 更新</p> <p>####18.4.2 数据劫持</p> <ol><li><p>数据劫持是 vue 中用来实现数据绑定的一种技术</p></li> <li><p>基本思想: 通过 defineProperty()来监视 data 中所有属性(任意层次)数据的变化, 一旦变 化就去更新界面</p></li></ol> <h4 id="_18-4-3-四个重要对象"><a href="#_18-4-3-四个重要对象" class="header-anchor">#</a> 18.4.3 四个重要对象</h4> <p><strong>1) Observer</strong></p> <p>a. 用来对 data 所有属性数据进行劫持的构造函数</p> <p>b. 给 data 中所有属性重新定义属性描述(get/set)</p> <p>c. 为 data 中的每个属性创建对应的 dep 对象</p> <p><strong>2) Dep(Depend)</strong></p> <p>a. <strong>data 中的每个属性(所有层次)都对应一个 dep 对象</strong></p> <p>b. 创建的时机:</p> <p>* 在初始化 define data 中各个属性时创建对应的 dep 对象</p> <p>* 在 data 中的某个属性值被设置为新的对象时</p> <p>c. 对象的结构</p> <p>{</p> <p>id, // 每个 dep 都有一个唯一的 id</p> <p>subs //包含 n 个对应 watcher 的数组(subscribes 的简写)</p> <p>}</p> <p>d. subs 属性说明</p> <p>* 当 watcher 被创建时, 内部将当前 watcher 对象添加到对应的 dep 对象的 subs 中</p> <p>* 当此 data 属性的值发生改变时, subs 中所有的 watcher 都会收到更新的通知,从而最终更新对应的界面</p> <p><strong>3) Compiler</strong></p> <p>a. 用来解析模板页面的对象的构造函数(一个实例)</p> <p>b. 利用 compile 对象解析模板页面</p> <p>c. 每解析一个表达式(非事件指令)都会创建一个对应的 watcher 对象, 并建立 watcher</p> <p>与 dep 的关系</p> <p>d. complie 与 watcher 关系: 一对多的关系</p> <p><strong>4) Watcher</strong></p> <p>a. <strong>模板中每个非事件指令或表达式都对应一个 watcher 对象</strong></p> <p>b. 监视当前表达式数据的变化</p> <p>c. 创建的时机: 在初始化编译模板时</p> <p>d. 对象的组成</p> <p>{</p> <p>vm, //vm 对象</p> <p>exp, //对应指令的表达式</p> <p>cb, //当表达式所对应的数据发生改变的回调函数</p> <p>value, //表达式当前的值</p> <p>depIds //表达式中各级属性所对应的 dep 对象的集合对象</p> <p>//属性名为 dep 的 id, 属性值为 dep</p> <p>}</p> <p><strong>5) 总结: dep 与 watcher 的关系: 多对多</strong></p> <p>a. data 中的一个属性对应一个 dep, 一个 dep 中可能包含多个 watcher(模板中有几个</p> <p>表达式使用到了同一个属性)</p> <p>b. 模板中一个非事件表达式对应一个 watcher, 一个 watcher 中可能包含多个 dep(表</p> <p>达式是多层: a.b)</p> <p>c. 数据绑定使用到 2 个核心技术</p> <p><code>defineProperty()</code> 消息订阅与发布</p> <h4 id="_18-4-4-双向数据绑定"><a href="#_18-4-4-双向数据绑定" class="header-anchor">#</a> 18.4.4 双向数据绑定</h4> <ol><li><p>双向数据绑定是建立在单向数据绑定(model==&gt;View)的基础之上的</p></li> <li><p>双向数据绑定的实现流程:</p></li></ol> <p>a. 在解析 v-model 指令时, 给当前元素添加 input 监听</p> <p>b. 当 input 的 value 发生改变时, 将最新的值赋值给当前表达式所对应的 data 属性</p> <h3 id="_18-5-数据驱动"><a href="#_18-5-数据驱动" class="header-anchor">#</a> 18.5 数据驱动</h3> <h4 id="_18-5-1-vue-与模板"><a href="#_18-5-1-vue-与模板" class="header-anchor">#</a> 18.5.1 Vue 与模板</h4> <p><strong>使用步骤</strong>:</p> <ol><li><p>编写页面模板，直接在 HTML 标签中写标签</p></li> <li><p>使用 template</p></li> <li><p>使用 单文件 <code>&lt;template /&gt;</code></p></li> <li><p>创建 Vue 的实例</p></li> <li><p>在 Vue 的构造函数中提供: data, methods, computed, watcher, props 等</p></li> <li><p>将 Vue 挂载到 页面中 <code>mount</code></p></li></ol> <h4 id="_18-5-2-数据驱动模型"><a href="#_18-5-2-数据驱动模型" class="header-anchor">#</a> 18.5.2 数据驱动模型</h4> <p><strong>Vue 的执行流程</strong>：</p> <ol><li><p>获得模板: 模板中有 &quot;坑&quot;</p></li> <li><p>利用 Vue 构造函数中所提供的数据来 &quot;填坑&quot;, 得到可以在页面中显示的 &quot;标签了&quot;</p></li> <li><p>将标签替换页面中原来有坑的标签</p></li></ol> <p><strong>所以，Vue 利用我们提供的数据和页面中模板生成了一个新的 HTML 标签 ( node 元素 )，替换到了页面中放置模板的位置。</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token constant">DOCTYPE</span> html<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>html lang<span class="token operator">=</span><span class="token string">&quot;en&quot;</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>head<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>meta charset<span class="token operator">=</span><span class="token string">&quot;UTF-8&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>meta name<span class="token operator">=</span><span class="token string">&quot;viewport&quot;</span> content<span class="token operator">=</span><span class="token string">&quot;width=device-width, initial-scale=1.0&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>meta http<span class="token operator">-</span>equiv<span class="token operator">=</span><span class="token string">&quot;X-UA-Compatible&quot;</span> content<span class="token operator">=</span><span class="token string">&quot;ie=edge&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>title<span class="token operator">&gt;</span>Document<span class="token operator">&lt;</span><span class="token operator">/</span>title<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">&quot;./node_modules/vue/dist/vue.min.js&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>head<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>body<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 第一步、写模板 <span class="token operator">--</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">&quot;root&quot;</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span>name<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span>message<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
      <span class="token comment">// 第一个打印的root鼠标放上去页面是不会有高亮的</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span>
      <span class="token comment">// 第二步，创建实例</span>
      <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        el<span class="token operator">:</span> <span class="token string">'#root'</span><span class="token punctuation">,</span>
        data<span class="token operator">:</span> <span class="token punctuation">{</span>
          name<span class="token operator">:</span> <span class="token string">'张三'</span><span class="token punctuation">,</span>
          message<span class="token operator">:</span> <span class="token string">'是人'</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token comment">// 第三步，挂载，Vue已经帮我们实现</span>
      <span class="token comment">// 第二个打印的root鼠标放上去页面才会有高亮的，因为Vue是替换模板，而不是在模板基础上进行修改</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><h3 id="_18-6-函数科里化和渲染模型"><a href="#_18-6-函数科里化和渲染模型" class="header-anchor">#</a> 18.6 函数科里化和渲染模型</h3> <h4 id="_18-6-1-函数科里化"><a href="#_18-6-1-函数科里化" class="header-anchor">#</a> 18.6.1 函数科里化</h4> <p><strong>什么是函数科里化？</strong></p> <ul><li><p><a href="https://llh911001.gitbooks.io/mostly-adequate-guide-chinese/content/" target="_blank" rel="noopener noreferrer">函数式编程<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></li> <li><p><a href="https://zh.wikipedia.org/wiki/%E6%9F%AF%E9%87%8C%E5%8C%96" target="_blank" rel="noopener noreferrer">维基百科<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></li></ul> <h4 id="_18-6-2-基本概念"><a href="#_18-6-2-基本概念" class="header-anchor">#</a> 18.6.2 基本概念</h4> <ul><li><p><strong>科里化</strong>： 一个函数原本有多个参数, 只传入<strong>一个</strong>参数, 生成一个新函数, 由新函数接收剩下的参数来运行得到结构。</p></li> <li><p><strong>偏函数</strong>： 一个函数原本有多个参数, 只传入<strong>一部分</strong>参数, 生成一个新函数, 由新函数接收剩下的参数来运行得到结构。</p></li> <li><p><strong>高阶函数</strong>：一个函数<strong>参数是一个函数</strong>, 该函数对参数这个函数进行加工, 得到一个函数, 这个加工用的函数就是高阶函数。</p></li></ul> <h4 id="_18-6-3-vue-中的函数科里化"><a href="#_18-6-3-vue-中的函数科里化" class="header-anchor">#</a> 18.6..3 Vue 中的函数科里化</h4> <p><strong>Vue 中使用函数科里化的直接受益就是能够提升性能，使用科里化能够缓存函数的一部分能力。</strong></p> <p>Vue 本质上是使用 HTML 的字符串作为模板的, 将字符串的 模板 转换为 AST, 再转换为 VNode。</p> <ul><li><p>模板 -&gt; AST</p></li> <li><p>AST -&gt; VNode</p></li> <li><p>VNode -&gt; DOM</p></li></ul> <p>在这三个阶段中，第一个阶段 模板 -&gt; AST 是最消耗性能的，因为在这里面进行了字符串的解析。在前面我们进行简单的模板渲染时并没有说明这个问题，其实 Vue 在真正的转换的时候不是那样直接转换的。</p> <p><strong>以 Vue 的例子来说，在 Vue 中每一个标签可以是真正的 HTML 标签, 也可以是自定义组件, 那么怎么区分？</strong></p> <p>其实，观察 Vue 的源码我们可以知道，Vue 已经内部事先将可以用的 HTML 标签都保存起来了。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> tags <span class="token operator">=</span>
  <span class="token string">&quot;html,body,base,head,link,meta,style,title,&quot;</span> <span class="token operator">+</span>
  <span class="token string">&quot;address,article,aside,footer,header,h1,h2,h3,h4,h5,h6,hgroup,nav,section,&quot;</span> <span class="token operator">+</span>
  <span class="token string">&quot;div,dd,dl,dt,figcaption,figure,picture,hr,img,li,main,ol,p,pre,ul,&quot;</span> <span class="token operator">+</span>
  <span class="token string">&quot;a,b,abbr,bdi,bdo,br,cite,code,data,dfn,em,i,kbd,mark,q,rp,rt,rtc,ruby,&quot;</span> <span class="token operator">+</span>
  <span class="token string">&quot;s,samp,small,span,strong,sub,sup,time,u,var,wbr,area,audio,map,track,video,&quot;</span> <span class="token operator">+</span>
  <span class="token string">&quot;embed,object,param,source,canvas,script,noscript,del,ins,&quot;</span> <span class="token operator">+</span>
  <span class="token string">&quot;caption,col,colgroup,table,thead,tbody,td,th,tr,&quot;</span> <span class="token operator">+</span>
  <span class="token string">&quot;button,datalist,fieldset,form,input,label,legend,meter,optgroup,option,&quot;</span> <span class="token operator">+</span>
  <span class="token string">&quot;output,progress,select,textarea,&quot;</span> <span class="token operator">+</span>
  <span class="token string">&quot;details,dialog,menu,menuitem,summary,&quot;</span> <span class="token operator">+</span>
  <span class="token string">&quot;content,element,shadow,template,blockquote,iframe,tfoot&quot;</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>但是，如果我们每次在进行判断的时候都要循环一次判断，这样做是非常消耗性能的。而使用科里化能够将指数次的时间复杂度降为 O(1)。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> tags <span class="token operator">=</span>
  <span class="token string">&quot;html,body,base,head,link,meta,style,title,&quot;</span> <span class="token operator">+</span>
  <span class="token string">&quot;address,article,aside,footer,header,h1,h2,h3,h4,h5,h6,hgroup,nav,section,&quot;</span> <span class="token operator">+</span>
  <span class="token string">&quot;div,dd,dl,dt,figcaption,figure,picture,hr,img,li,main,ol,p,pre,ul,&quot;</span> <span class="token operator">+</span>
  <span class="token string">&quot;a,b,abbr,bdi,bdo,br,cite,code,data,dfn,em,i,kbd,mark,q,rp,rt,rtc,ruby,&quot;</span> <span class="token operator">+</span>
  <span class="token string">&quot;s,samp,small,span,strong,sub,sup,time,u,var,wbr,area,audio,map,track,video,&quot;</span> <span class="token operator">+</span>
  <span class="token string">&quot;embed,object,param,source,canvas,script,noscript,del,ins,&quot;</span> <span class="token operator">+</span>
  <span class="token string">&quot;caption,col,colgroup,table,thead,tbody,td,th,tr,&quot;</span> <span class="token operator">+</span>
  <span class="token string">&quot;button,datalist,fieldset,form,input,label,legend,meter,optgroup,option,&quot;</span> <span class="token operator">+</span>
  <span class="token string">&quot;output,progress,select,textarea,&quot;</span> <span class="token operator">+</span>
  <span class="token string">&quot;details,dialog,menu,menuitem,summary,&quot;</span> <span class="token operator">+</span>
  <span class="token string">&quot;content,element,shadow,template,blockquote,iframe,tfoot&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function">makeMap</span><span class="token punctuation">(</span><span class="token parameter">tags</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> keys <span class="token operator">=</span> tags<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">&quot;,&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token keyword">set</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  keys<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">key</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token keyword">set</span><span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 我们只需要通过函数是否有该属性来判断</span>
  <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">tagName</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">!</span><span class="token operator">!</span><span class="token keyword">set</span><span class="token punctuation">[</span>tagName<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 得到这个函数来进行HTML标签和组件的判断</span>
<span class="token keyword">const</span> isHTMLTag <span class="token operator">=</span> <span class="token function">makeMap</span><span class="token punctuation">(</span>tags<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p><strong>那么，为什么不将<code>set</code>定义为全局对象，这样一样能够实现效果？</strong></p> <p>因为使用<code>makeMap</code>获取各种判断的函数并不止会用一次，在 Vue 中不止是处理了 HTML 的标签，还有很多其他的标签，类似<code>svg</code>这样。所以，为了区分开以及代码的复用性，我们更倾向将其进行科里化处理。</p> <h4 id="_18-6-4-vue-的渲染模型（极简）"><a href="#_18-6-4-vue-的渲染模型（极简）" class="header-anchor">#</a> 18.6.4 Vue 的渲染模型（极简）</h4> <p><strong>Vue 在获取到渲染函数的时候也是通过函数科里化实现的，目的在于将抽象语法树保存在内存中，增加性能。</strong></p> <p>我们在这里不直接将抽象语法树转换为 VNode，写一个极简的渲染模型，使用空的 VNode 模板进行渲染。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token constant">DOCTYPE</span> html<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>html lang<span class="token operator">=</span><span class="token string">&quot;en&quot;</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>head<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>meta charset<span class="token operator">=</span><span class="token string">&quot;UTF-8&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>meta name<span class="token operator">=</span><span class="token string">&quot;viewport&quot;</span> content<span class="token operator">=</span><span class="token string">&quot;width=device-width, initial-scale=1.0&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>meta http<span class="token operator">-</span>equiv<span class="token operator">=</span><span class="token string">&quot;X-UA-Compatible&quot;</span> content<span class="token operator">=</span><span class="token string">&quot;ie=edge&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>title<span class="token operator">&gt;</span>Document<span class="token operator">&lt;</span><span class="token operator">/</span>title<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>head<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>body<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">&quot;root&quot;</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span>name<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span>age<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span>gender<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;box&quot;</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>box<span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
      <span class="token comment">// 将真正的DOM转换为VNode</span>
      <span class="token keyword">function</span> <span class="token function">getVNode</span><span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> nodeType <span class="token operator">=</span> node<span class="token punctuation">.</span>nodeType
        <span class="token keyword">let</span> _vnode <span class="token operator">=</span> <span class="token keyword">null</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>nodeType <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">const</span> nodeName <span class="token operator">=</span> node<span class="token punctuation">.</span>nodeName
          <span class="token keyword">const</span> attrs <span class="token operator">=</span> node<span class="token punctuation">.</span>attributes
          <span class="token keyword">let</span> _attrObj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
          <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> attrs<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            _attrObj<span class="token punctuation">[</span>attrs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>nodeName<span class="token punctuation">]</span> <span class="token operator">=</span> attrs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>nodeValue
          <span class="token punctuation">}</span>
          _vnode <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VNode</span><span class="token punctuation">(</span>nodeName<span class="token punctuation">,</span> _attrObj<span class="token punctuation">,</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span> nodeType<span class="token punctuation">)</span>

          <span class="token comment">// 考虑node的子元素</span>
          <span class="token keyword">const</span> childNodes <span class="token operator">=</span> node<span class="token punctuation">.</span>childNodes
          <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> childNodes<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            _vnode<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span><span class="token function">getVNode</span><span class="token punctuation">(</span>childNodes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>nodeType <span class="token operator">===</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          _vnode <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VNode</span><span class="token punctuation">(</span><span class="token keyword">undefined</span><span class="token punctuation">,</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span> node<span class="token punctuation">.</span>nodeValue<span class="token punctuation">,</span> nodeType<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> _vnode
      <span class="token punctuation">}</span>
      <span class="token comment">// 将VNode转换为真正的DOM</span>
      <span class="token keyword">function</span> <span class="token function">parseVNode</span><span class="token punctuation">(</span><span class="token parameter">vnode</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 创建真实的DOM节点</span>
        <span class="token keyword">const</span> type <span class="token operator">=</span> vnode<span class="token punctuation">.</span>type
        <span class="token keyword">let</span> _node <span class="token operator">=</span> <span class="token keyword">null</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>type <span class="token operator">===</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">// 创建文本节点</span>
          <span class="token keyword">return</span> document<span class="token punctuation">.</span><span class="token function">createTextNode</span><span class="token punctuation">(</span>vnode<span class="token punctuation">.</span>value<span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>type <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          _node <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span>vnode<span class="token punctuation">.</span>tag<span class="token punctuation">)</span>
          <span class="token comment">// 属性</span>
          <span class="token keyword">const</span> data <span class="token operator">=</span> vnode<span class="token punctuation">.</span>data <span class="token comment">// 现在这个data是键值对</span>
          Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">key</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> attrName <span class="token operator">=</span> key
            <span class="token keyword">const</span> attrValue <span class="token operator">=</span> data<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
            _node<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span>attrName<span class="token punctuation">,</span> attrValue<span class="token punctuation">)</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span>

          <span class="token comment">// 创建子元素</span>
          <span class="token keyword">const</span> children <span class="token operator">=</span> vnode<span class="token punctuation">.</span>children
          children<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">subvnode</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            _node<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span><span class="token function">parseVNode</span><span class="token punctuation">(</span>subvnode<span class="token punctuation">)</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
          <span class="token keyword">return</span> _node
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">const</span> Mustache <span class="token operator">=</span> <span class="token regex">/\{\{(.+?)\}\}/g</span>
      <span class="token comment">// 根据路径访问对象成员</span>
      <span class="token keyword">function</span> <span class="token function">getValueByPath</span><span class="token punctuation">(</span><span class="token parameter">obj<span class="token punctuation">,</span> path</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> paths <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span> <span class="token comment">// a.b.c</span>
        <span class="token comment">// 先取到a.b，再取到a.b.c</span>
        <span class="token keyword">let</span> res <span class="token operator">=</span> obj
        <span class="token keyword">let</span> prop <span class="token operator">=</span> <span class="token string">''</span>
        <span class="token comment">// 如果没有值最后为undefined</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>prop <span class="token operator">=</span> paths<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          res <span class="token operator">=</span> res<span class="token punctuation">[</span>prop<span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> res
      <span class="token punctuation">}</span>
      <span class="token comment">// 让模板与数据结合</span>
      <span class="token keyword">function</span> <span class="token function">combine</span><span class="token punctuation">(</span><span class="token parameter">vnode<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> _type <span class="token operator">=</span> vnode<span class="token punctuation">.</span>type
        <span class="token keyword">const</span> _data <span class="token operator">=</span> vnode<span class="token punctuation">.</span>data
        <span class="token keyword">const</span> _value <span class="token operator">=</span> vnode<span class="token punctuation">.</span>value
        <span class="token keyword">const</span> _tag <span class="token operator">=</span> vnode<span class="token punctuation">.</span>tag
        <span class="token keyword">const</span> _children <span class="token operator">=</span> vnode<span class="token punctuation">.</span>children

        <span class="token keyword">let</span> _vnode <span class="token operator">=</span> <span class="token keyword">null</span>
        <span class="token comment">// 对文本节点的处理</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>_type <span class="token operator">===</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          _parsedValue <span class="token operator">=</span> _value<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>Mustache<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">_<span class="token punctuation">,</span> g</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
            <span class="token function">getValueByPath</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> g<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
          <span class="token punctuation">)</span>
          _vnode <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VNode</span><span class="token punctuation">(</span>_tag<span class="token punctuation">,</span> _data<span class="token punctuation">,</span> _parsedValue<span class="token punctuation">,</span> _type<span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>_type <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">// 元素节点</span>
          _vnode <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VNode</span><span class="token punctuation">(</span>_tag<span class="token punctuation">,</span> _data<span class="token punctuation">,</span> _value<span class="token punctuation">,</span> _type<span class="token punctuation">)</span>
          _children<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">_subvnode</span> <span class="token operator">=&gt;</span>
            _vnode<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span><span class="token function">combine</span><span class="token punctuation">(</span>_subvnode<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">)</span>
          <span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> _vnode
      <span class="token punctuation">}</span>

      <span class="token keyword">class</span> <span class="token class-name">VNode</span> <span class="token punctuation">{</span>
        <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">tag<span class="token punctuation">,</span> data<span class="token punctuation">,</span> value<span class="token punctuation">,</span> type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>tag <span class="token operator">=</span> tag <span class="token operator">&amp;&amp;</span> tag<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>data <span class="token operator">=</span> data
          <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> value
          <span class="token keyword">this</span><span class="token punctuation">.</span>type <span class="token operator">=</span> type
          <span class="token keyword">this</span><span class="token punctuation">.</span>children <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
        <span class="token function">appendChild</span><span class="token punctuation">(</span><span class="token parameter">vnode</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>children<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>vnode<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">class</span> <span class="token class-name">MyVue</span> <span class="token punctuation">{</span>
        <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>_options <span class="token operator">=</span> options
          <span class="token keyword">this</span><span class="token punctuation">.</span>_data <span class="token operator">=</span> options<span class="token punctuation">.</span>data
          <span class="token keyword">this</span><span class="token punctuation">.</span>_el <span class="token operator">=</span> options<span class="token punctuation">.</span>el
          <span class="token keyword">const</span> elm <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>el<span class="token punctuation">)</span> <span class="token comment">// 在Vue中这里是字符串，我们这里简化为DOM</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>_template <span class="token operator">=</span> elm
          <span class="token keyword">this</span><span class="token punctuation">.</span>_parent <span class="token operator">=</span> elm<span class="token punctuation">.</span>parentNode
          <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">mount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 挂载</span>
        <span class="token punctuation">}</span>
        <span class="token function">mount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">// 需要提供一个render方法来生成虚拟DOM,引入Vue是可以传入自定义render方法的，该方法让用户提供自定义的VNode</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_options<span class="token punctuation">.</span>render <span class="token operator">!==</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>render <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">createRenderFn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 带有缓存</span>
          <span class="token punctuation">}</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">mountComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token function">mountComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">// 执行 mountComponent函数</span>
          <span class="token keyword">const</span> <span class="token function-variable function">mount</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
          <span class="token comment">// 在Vue中其实是交给 watcher 来调用，现在就这样写</span>
          <span class="token function">mount</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token comment">/*
          在真正的 Vue中使用了二次提交的设计结构
          1.在页面中的DOM和虚拟DOM是一一对应的关系
          2.先由 AST 和数据生成VNode（这个是新产生的VNode）
          3.将原来的旧的VNode与新的VNode进行比较（使用diff算法），再更新（update）
        */</span>
        <span class="token comment">// 这里是生成render函数，目的是缓存抽象语法树（现在这里我们先使用虚拟DOM来进行模拟）</span>
        <span class="token function">createRenderFn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">const</span> ast <span class="token operator">=</span> <span class="token function">getVNode</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_template<span class="token punctuation">)</span>
          <span class="token comment">// 在Vue中是直接：AST + DATA -&gt; VNode</span>

          <span class="token comment">// 我们这里做简化，将模板转换的直接的空的VNode转换为由数据的VNode</span>
          <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 带有缓存</span>
            <span class="token keyword">const</span> _tmp <span class="token operator">=</span> <span class="token function">combine</span><span class="token punctuation">(</span>ast<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_data<span class="token punctuation">)</span>
            <span class="token keyword">return</span> _tmp
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 将虚拟DOM渲染到页面中，diff算法就在这个地方</span>
        <span class="token function">update</span><span class="token punctuation">(</span><span class="token parameter">vnode</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">const</span> realDOM <span class="token operator">=</span> <span class="token function">parseVNode</span><span class="token punctuation">(</span>vnode<span class="token punctuation">)</span>
          <span class="token comment">// 对这个过程简化，直接生成 DOM 通过替换的方式到页面中去，真实情况不是这样全部替换，而是通过diff算法一级一级比较然后改变原来的对象</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>_parent<span class="token punctuation">.</span><span class="token function">replaceChild</span><span class="token punctuation">(</span>realDOM<span class="token punctuation">,</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_el<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyVue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        el<span class="token operator">:</span> <span class="token string">'#root'</span><span class="token punctuation">,</span>
        data<span class="token operator">:</span> <span class="token punctuation">{</span>
          name<span class="token operator">:</span> <span class="token string">'张三'</span><span class="token punctuation">,</span>
          age<span class="token operator">:</span> <span class="token number">18</span><span class="token punctuation">,</span>
          gender<span class="token operator">:</span> <span class="token string">'男'</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br><span class="line-number">180</span><br></div></div><h3 id="_18-7-响应式原理"><a href="#_18-7-响应式原理" class="header-anchor">#</a> 18.7 响应式原理</h3> <p><strong>Vue 的响应式基本有着下面几点：</strong></p> <ul><li><p>在使用 Vue 时候, 赋值属性获得属性都是直接使用的 Vue 实例（通过<code>this.xxx</code>获取，而不是<code>this._data.xxx</code>）。</p></li> <li><p>在涉及属性值的时候, 页面的数据更新。</p></li></ul> <h4 id="_18-7-1-属性描述符"><a href="#_18-7-1-属性描述符" class="header-anchor">#</a> 18.7.1 属性描述符</h4> <p>在 ES5 之前，JavaScript 没有内置的机制来指定或者检查对象某个属性(property)的特性(characteristics)，比如某个属性是只读(readonly)的或者不能被枚举(enumerable)的。但是在 ES5 之后，JavaScript 被赋予了这个能力，所有的对象属性都可以通过属性描述符(Property Descriptor)来指定。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> myObject <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>myObject<span class="token punctuation">,</span> <span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  value<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
  writable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 可写</span>
  configurable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 可配置</span>
  enumerable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 可遍历</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 上面的定义等同于 myObject.a = 2;</span>
<span class="token comment">// 所以如果不需要修改这三个特性，我们一般不会用 `Object.defineProperty`</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>myObject<span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p><strong>属性描述符的六个属性</strong></p> <ul><li><p>value：属性值</p></li> <li><p>writable：是否允许赋值，</p> <p>true</p> <p>表示允许，否则该属性不允许赋值</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>let myObject = {}

Object.defineProperty(myObject, 'a', {
  value: 2,
  writable: false, // 不可写
  configurable: true,
  enumerable: true
})

myObject.a = 3 // 写入的值将会被忽略
console.log(myObject.a) // 2
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div></li> <li><p>get：返回属性值的函数。如果为 <strong>undefined</strong> 则直接返回描述符中定义的 <strong>value</strong> 值</p></li> <li><p>set：属性的赋值函数。如果为 <strong>undefined</strong> 则直接将赋值运算符右侧的值保存为属性值
<strong>注：</strong></p></li> <li><ul><li>一旦同时使用了<code>get</code>和<code>set</code>，需要一个中间变量存储真正的值。</li></ul></li> <li><ul><li><code>set</code>和<code>writable:false</code>是不能共存的。</li></ul></li> <li><p>configurable：如果为</p> <p>true</p> <p>，则表示该属性可以重新使用（</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>）定义描述符，或者从属性的宿主删除。缺省为</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token boolean">true</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> myObject <span class="token operator">=</span> <span class="token punctuation">{</span>
  a<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>myObject<span class="token punctuation">,</span> <span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  value<span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
  writable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  configurable<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 不可配置!</span>
  enumerable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>myObject<span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 4</span>
myObject<span class="token punctuation">.</span>a <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
<span class="token comment">// 因为最开始writable时true，所以不会影响到赋值</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>myObject<span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 5</span>

Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>myObject<span class="token punctuation">,</span> <span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  value<span class="token operator">:</span> <span class="token number">6</span><span class="token punctuation">,</span>
  writable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  configurable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  enumerable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// TypeError</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>注：</p> <p>一旦某个属性被指定为</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>configurable: false
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>，那么就不能从新指定为</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>configurable: true
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>了，这个操作是单向，不可逆的</p> <p>这个特性还会影响<code>delete</code> 操作的行为</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> myObject <span class="token operator">=</span> <span class="token punctuation">{</span>
  a<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>myObject<span class="token punctuation">,</span> <span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  value<span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
  writable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  configurable<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 不可配置!</span>
  enumerable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">delete</span> myObject<span class="token punctuation">.</span>a<span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>myObject<span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 4</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div></li> <li><p>enumerable：如果为</p> <p>true</p> <p>，则表示遍历宿主对象时，该属性可以被遍历到（比如</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>for..in
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>循环中）。缺省为</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>true
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">let</span> myObject <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>
  myObject<span class="token punctuation">,</span>
  <span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span>
  <span class="token comment">// make `a` enumerable, as normal</span>
  <span class="token punctuation">{</span> enumerable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>
  myObject<span class="token punctuation">,</span>
  <span class="token string">&quot;b&quot;</span><span class="token punctuation">,</span>
  <span class="token comment">// make `b` NON-enumerable</span>
  <span class="token punctuation">{</span> enumerable<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token number">3</span> <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>myObject<span class="token punctuation">.</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 3</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;b&quot;</span> <span class="token keyword">in</span> myObject<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
myObject<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span><span class="token string">&quot;b&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>

<span class="token comment">// .......</span>
<span class="token comment">// 无法被遍历到</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> k <span class="token keyword">in</span> myObject<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> myObject<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// &quot;a&quot; 2</span>

myObject<span class="token punctuation">.</span><span class="token function">propertyIsEnumerable</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
myObject<span class="token punctuation">.</span><span class="token function">propertyIsEnumerable</span><span class="token punctuation">(</span><span class="token string">&quot;b&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false</span>
Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>myObject<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [&quot;a&quot;]</span>
Object<span class="token punctuation">.</span><span class="token function">getOwnPropertyNames</span><span class="token punctuation">(</span>myObject<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [&quot;a&quot;, &quot;b&quot;]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><p>可以看出，</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>enumerable: false
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>使得该属性从对象属性枚举操作中被隐藏，但</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>Object.hasOwnProperty(...)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>仍然可以检测到属性的存在。另外，</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>Object.propertyIsEnumerable(..)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>可以用来检测某个属性是否可枚举,</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>Object.keys(...)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>仅仅返回可枚举的属性，而</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>Object.getOwnPropertyNames(...)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>则返回该对象上的所有属性，包括不可枚举的</p></li></ul> <p><strong>注</strong>：Object 有专门操作属性的方法，在这里就不再多讲了</p> <h4 id="_18-7-2-vue-中使用属性描述符"><a href="#_18-7-2-vue-中使用属性描述符" class="header-anchor">#</a> 18.7.2 Vue 中使用属性描述符</h4> <p>在 Vue 中因为全部依赖的是响应式，所以直接使用会有命名冲突的问题，我们使用闭包来解决这个问题。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> o <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">&quot;张三&quot;</span><span class="token punctuation">,</span>
  age<span class="token operator">:</span> <span class="token string">&quot;18&quot;</span><span class="token punctuation">,</span>
  gender<span class="token operator">:</span> <span class="token string">&quot;男&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// 简化后的版本</span>
<span class="token keyword">function</span> <span class="token function">defineRective</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> enumerable</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 函数内部形成一个局部作用域，value只在内部使用（闭包，避免污染全局）</span>
  Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    configurable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    enumerable<span class="token operator">:</span> <span class="token operator">!</span><span class="token operator">!</span>enumerable<span class="token punctuation">,</span>
    <span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">读取 o 的 </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> 属性</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 额外</span>
      <span class="token keyword">return</span> value<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">set</span><span class="token punctuation">(</span>newValue<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">设置 o 的 </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> 属性为: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>newValue<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 额外</span>
      value <span class="token operator">=</span> newValue<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// {name: &quot;张三&quot;, age: &quot;18&quot;, gender: &quot;男&quot;}</span>
<span class="token comment">// 将对象转换为响应式的，会将原来的键值覆盖掉</span>
Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">key</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">defineRective</span><span class="token punctuation">(</span>o<span class="token punctuation">,</span> key<span class="token punctuation">,</span> o<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// {}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><p>但是，上面的只能对基本类型的数据进行响应式化，所以我们需要进行递归修改。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> o <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">&quot;张三&quot;</span><span class="token punctuation">,</span>
  age<span class="token operator">:</span> <span class="token string">&quot;18&quot;</span><span class="token punctuation">,</span>
  gender<span class="token operator">:</span> <span class="token string">&quot;男&quot;</span><span class="token punctuation">,</span>
  courses<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      name<span class="token operator">:</span> <span class="token string">&quot;语文&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      name<span class="token operator">:</span> <span class="token string">&quot;数学&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// 简化后的版本</span>
<span class="token keyword">function</span> <span class="token function">defineRective</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> enumerable</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 函数内部形成一个局部作用域，value只在内部使用（闭包，避免污染全局）</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> value <span class="token operator">===</span> <span class="token string">&quot;object&quot;</span> <span class="token operator">&amp;&amp;</span> value <span class="token operator">!==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 非数组引用类型</span>
    <span class="token function">reactify</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    configurable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    enumerable<span class="token operator">:</span> <span class="token operator">!</span><span class="token operator">!</span>enumerable<span class="token punctuation">,</span>
    <span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">获取</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">属性</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> value<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">set</span><span class="token punctuation">(</span>newValue<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">设置</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">属性</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      value <span class="token operator">=</span> newValue<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">reactify</span><span class="token punctuation">(</span><span class="token parameter">o</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">key</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 将对象转换为响应式的，会将原来的键值覆盖掉</span>
    <span class="token comment">/*
          1.判断这个属性是否为引用类型，是否是数组
          2.
          （1）如果是引用类型就递归，如果不是就不需要
          （2）如果是数组，需要循环数组，然后将数组里面的元素进行响应式话
        */</span>
    <span class="token comment">// 数组</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>o<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      o<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">reactify</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token comment">// 对象或值类型</span>
      <span class="token function">defineRective</span><span class="token punctuation">(</span>o<span class="token punctuation">,</span> key<span class="token punctuation">,</span> o<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">reactify</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br></div></div><h4 id="_18-7-3-vue-中对数组方法的扩展"><a href="#_18-7-3-vue-中对数组方法的扩展" class="header-anchor">#</a> 18.7.3 Vue 中对数组方法的扩展</h4> <p>对于对象和数组添加新的属性时也需要做到响应式，在 Vue 官方文档中可以通过<code>$set</code>方法进行设置，都是使用递归来进行响应式化，但是数组的的一些改变原数组的方法在调用时也需要有响应式化，如：</p> <ul><li><p>push</p></li> <li><p>pop</p></li> <li><p>shift</p></li> <li><p>unshift</p></li> <li><p>reverse</p></li> <li><p>sort</p></li> <li><p>splice</p></li></ul> <p><strong>我们需要在改变数组的数据的时候, 发出通知，将新加入的元素变成响应式的。</strong></p> <p><strong>注意</strong>：在 Vue 2.x 中，因为使用的是 Object 的<code>defineProperty</code>方法, 数组发生变化, 设置 length 没法通知 ( Vue 3 中使用 Proxy 语法 ES6 的语法解决了这个问题 )。</p> <h5 id="_18-7-3-1-扩展函数功能"><a href="#_18-7-3-1-扩展函数功能" class="header-anchor">#</a> 18.7.3.1 扩展函数功能</h5> <p><strong>如果一个函数已经定义了, 但是我们需要扩展其功能, 我们一般的处理办法:</strong></p> <ol><li><p>使用一个临时的函数名存储函数</p></li> <li><p>重新定义原来的函数</p></li> <li><p>定义扩展的功能</p></li> <li><p>调用临时的那个函数</p></li></ol> <h5 id="_18-7-3-2-vue-中的拦截数组"><a href="#_18-7-3-2-vue-中的拦截数组" class="header-anchor">#</a> 18.7.3.2 Vue 中的拦截数组</h5> <p>如果要修改数组的方法，我们不能通过直接修改数组的<code>prototype</code>，因为这样会将所有的数组方法都改了，而是<strong>修改要进行响应式化的数组的原型 ( <code>__proto__</code> )。</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token constant">ARRAY_METHOD</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token string">&quot;push&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;pop&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;shift&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;unshift&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;reverse&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;sort&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;splice&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">// 原型式继承：修改原型链的结构</span>
<span class="token keyword">let</span> arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> array_method <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token class-name">Array</span><span class="token punctuation">.</span>prototype<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token constant">ARRAY_METHOD</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">method</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  array_method<span class="token punctuation">[</span>method<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//调用原来的方法</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">调用拦截的</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>method<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">方法</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 将数据进行响应式化</span>
    <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token class-name">Array</span><span class="token punctuation">.</span>prototype<span class="token punctuation">[</span>method<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> res<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
arr<span class="token punctuation">.</span>__proto__ <span class="token operator">=</span> array_method<span class="token punctuation">;</span>
<span class="token comment">/*
        Vue的源码中也做了这样的办法：
        1.如果浏览器支持__proto__就放原型上
        2.如果不支持Vue使用的混入的方法，Vue会挂载到当前对象上
*/</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><p>这样，在使用数组方法的时候就能够触发<code>console.log</code>了。</p> <h5 id="_18-7-3-3-vue-数组的响应式化"><a href="#_18-7-3-3-vue-数组的响应式化" class="header-anchor">#</a> 18.7.3.3 Vue 数组的响应式化</h5> <p>所以，在数组中要响应式需要再修改一下上面的<code>reactify</code>函数。同时，如果是直接用对象或者数组进行赋值，也需要响应式化，需要修改一下<code>defineRective</code>函数定义属性时候的<code>set</code>方法</p> <p>**注意：**下面的代码在，直接赋值的响应式化只能够原来的值不是数组或者对象才行，数组和对象在一开始赋值的时候本身就不是一个响应式数据，而是它的成员或属性才是，所以直接赋值的时候并不会触发<code>set</code>方法，在之后会单独再进行修改。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">defineRective</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> enumerable</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 函数内部形成一个局部作用域，value只在内部使用（闭包，避免污染全局）</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> value <span class="token operator">===</span> <span class="token string">&quot;object&quot;</span> <span class="token operator">&amp;&amp;</span> value <span class="token operator">!==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 非数组引用类型</span>
    <span class="token function">reactify</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    configurable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    enumerable<span class="token operator">:</span> <span class="token operator">!</span><span class="token operator">!</span>enumerable<span class="token punctuation">,</span>
    <span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">获取</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">属性</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> value<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">set</span><span class="token punctuation">(</span>newValue<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">设置</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">属性</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// 如果是数组等直接赋值，也需要响应式化</span>
      value <span class="token operator">=</span> newValue<span class="token punctuation">;</span>
      <span class="token function">reactify</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">reactify</span><span class="token punctuation">(</span><span class="token parameter">o</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">key</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 将对象转换为响应式的，会将原来的键值覆盖掉</span>
    <span class="token comment">/*
          1.判断这个属性是否为引用类型，是否是数组
          2.
          （1）如果是引用类型就递归，如果不是就不需要
          （2）如果是数组，需要循环数组，然后将数组里面的元素进行响应式话
        */</span>
    <span class="token comment">// 数组</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>o<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 现在的数组就是响应式</span>
      o<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">.</span>__proto__ <span class="token operator">=</span> array_method<span class="token punctuation">;</span>
      o<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">reactify</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token comment">// 对象或值类型</span>
      <span class="token function">defineRective</span><span class="token punctuation">(</span>o<span class="token punctuation">,</span> key<span class="token punctuation">,</span> o<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br></div></div><h5 id="_18-7-3-4-响应式刷新页面"><a href="#_18-7-3-4-响应式刷新页面" class="header-anchor">#</a> 18.7.3.4 响应式刷新页面</h5> <p>将响应式读取数据与前面的模板页面相结合，就能够做到响应式刷新页面了。</p> <p><strong>下面是集成上面代码的一个简易框架：</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token constant">DOCTYPE</span> html<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>html lang<span class="token operator">=</span><span class="token string">&quot;en&quot;</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>head<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>meta charset<span class="token operator">=</span><span class="token string">&quot;UTF-8&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>meta name<span class="token operator">=</span><span class="token string">&quot;viewport&quot;</span> content<span class="token operator">=</span><span class="token string">&quot;width=device-width, initial-scale=1.0&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>meta http<span class="token operator">-</span>equiv<span class="token operator">=</span><span class="token string">&quot;X-UA-Compatible&quot;</span> content<span class="token operator">=</span><span class="token string">&quot;ie=edge&quot;</span> <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>title<span class="token operator">&gt;</span>Document<span class="token operator">&lt;</span><span class="token operator">/</span>title<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>head<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>body<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">&quot;root&quot;</span><span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span>name<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span>age<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span>gender<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span>div <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;box&quot;</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>box<span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
      <span class="token keyword">const</span> <span class="token constant">ARRAY_METHOD</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token string">'push'</span><span class="token punctuation">,</span>
        <span class="token string">'pop'</span><span class="token punctuation">,</span>
        <span class="token string">'shift'</span><span class="token punctuation">,</span>
        <span class="token string">'unshift'</span><span class="token punctuation">,</span>
        <span class="token string">'reverse'</span><span class="token punctuation">,</span>
        <span class="token string">'sort'</span><span class="token punctuation">,</span>
        <span class="token string">'splice'</span>
      <span class="token punctuation">]</span>

      <span class="token comment">// 原型式继承：修改原型链的结构</span>
      <span class="token keyword">const</span> array_method <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token class-name">Array</span><span class="token punctuation">.</span>prototype<span class="token punctuation">)</span>

      <span class="token constant">ARRAY_METHOD</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">method</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        array_method<span class="token punctuation">[</span>method<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">// 将数据进行响应式化</span>
          <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> arguments<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 因为缺陷，这里无法传入vm</span>
            <span class="token function">reactify</span><span class="token punctuation">(</span>arguments<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span>

          <span class="token comment">//调用原来的方法</span>
          <span class="token keyword">const</span> res <span class="token operator">=</span> <span class="token class-name">Array</span><span class="token punctuation">.</span>prototype<span class="token punctuation">[</span>method<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> arguments<span class="token punctuation">)</span>
          <span class="token keyword">return</span> res
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>

      <span class="token comment">// 简化后的版本</span>
      <span class="token keyword">function</span> <span class="token function">defineRective</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> enumerable</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 函数内部形成一个局部作用域，value只在内部使用（闭包，避免污染全局）</span>
        <span class="token comment">// 折中处理后的Vue实例</span>
        <span class="token keyword">const</span> _this <span class="token operator">=</span> <span class="token keyword">this</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>
          <span class="token keyword">typeof</span> value <span class="token operator">===</span> <span class="token string">'object'</span> <span class="token operator">&amp;&amp;</span>
          value <span class="token operator">!==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span>
          <span class="token operator">!</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
        <span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">// 非数组引用类型</span>
          <span class="token function">reactify</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>

        Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token punctuation">{</span>
          configurable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
          enumerable<span class="token operator">:</span> <span class="token operator">!</span><span class="token operator">!</span>enumerable<span class="token punctuation">,</span>
          <span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">获取</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">属性</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> value
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token keyword">set</span><span class="token punctuation">(</span>newValue<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">设置</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>key<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">属性</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
            value <span class="token operator">=</span> newValue
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> value <span class="token operator">===</span> <span class="token string">'object'</span> <span class="token operator">&amp;&amp;</span> value <span class="token operator">!==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token function">reactify</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
            <span class="token comment">// 进行模板刷新，因为要获取Vue实例，这里就通过传入参数的形式获取，真实的Vue是通过watcher来获取的，以后会有修改</span>
            _this<span class="token punctuation">.</span><span class="token function">mountComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">function</span> <span class="token function">reactify</span><span class="token punctuation">(</span><span class="token parameter">o<span class="token punctuation">,</span> vm</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">key</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token comment">// 将对象转换为响应式的，会将原来的键值覆盖掉</span>
          <span class="token comment">/*
          1.判断这个属性是否为引用类型，是否是数组
          2.
          （1）如果是引用类型就递归，如果不是就不需要
          （2）如果是数组，需要循环数组，然后将数组里面的元素进行响应式话
        */</span>
          <span class="token comment">// 数组</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>o<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 现在的数组就是响应式</span>
            o<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">.</span>__proto__ <span class="token operator">=</span> array_method
            o<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">value</span> <span class="token operator">=&gt;</span> <span class="token function">reactify</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> vm<span class="token punctuation">)</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">// 对象或值类型</span>
            <span class="token function">defineRective</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> o<span class="token punctuation">,</span> key<span class="token punctuation">,</span> o<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      <span class="token comment">// 将真正的DOM转换为VNode</span>
      <span class="token keyword">function</span> <span class="token function">getVNode</span><span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> nodeType <span class="token operator">=</span> node<span class="token punctuation">.</span>nodeType
        <span class="token keyword">let</span> _vnode <span class="token operator">=</span> <span class="token keyword">null</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>nodeType <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">const</span> nodeName <span class="token operator">=</span> node<span class="token punctuation">.</span>nodeName
          <span class="token keyword">const</span> attrs <span class="token operator">=</span> node<span class="token punctuation">.</span>attributes
          <span class="token keyword">let</span> _attrObj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
          <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> attrs<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            _attrObj<span class="token punctuation">[</span>attrs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>nodeName<span class="token punctuation">]</span> <span class="token operator">=</span> attrs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>nodeValue
          <span class="token punctuation">}</span>
          _vnode <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VNode</span><span class="token punctuation">(</span>nodeName<span class="token punctuation">,</span> _attrObj<span class="token punctuation">,</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span> nodeType<span class="token punctuation">)</span>

          <span class="token comment">// 考虑node的子元素</span>
          <span class="token keyword">const</span> childNodes <span class="token operator">=</span> node<span class="token punctuation">.</span>childNodes
          <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> childNodes<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            _vnode<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span><span class="token function">getVNode</span><span class="token punctuation">(</span>childNodes<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>nodeType <span class="token operator">===</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          _vnode <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VNode</span><span class="token punctuation">(</span><span class="token keyword">undefined</span><span class="token punctuation">,</span> <span class="token keyword">undefined</span><span class="token punctuation">,</span> node<span class="token punctuation">.</span>nodeValue<span class="token punctuation">,</span> nodeType<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> _vnode
      <span class="token punctuation">}</span>
      <span class="token comment">// 将VNode转换为真正的DOM</span>
      <span class="token keyword">function</span> <span class="token function">parseVNode</span><span class="token punctuation">(</span><span class="token parameter">vnode</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 创建真实的DOM节点</span>
        <span class="token keyword">const</span> type <span class="token operator">=</span> vnode<span class="token punctuation">.</span>type
        <span class="token keyword">let</span> _node <span class="token operator">=</span> <span class="token keyword">null</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>type <span class="token operator">===</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">// 创建文本节点</span>
          <span class="token keyword">return</span> document<span class="token punctuation">.</span><span class="token function">createTextNode</span><span class="token punctuation">(</span>vnode<span class="token punctuation">.</span>value<span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>type <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          _node <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span>vnode<span class="token punctuation">.</span>tag<span class="token punctuation">)</span>
          <span class="token comment">// 属性</span>
          <span class="token keyword">const</span> data <span class="token operator">=</span> vnode<span class="token punctuation">.</span>data <span class="token comment">// 现在这个data是键值对</span>
          Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">key</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> attrName <span class="token operator">=</span> key
            <span class="token keyword">const</span> attrValue <span class="token operator">=</span> data<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
            _node<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span>attrName<span class="token punctuation">,</span> attrValue<span class="token punctuation">)</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span>

          <span class="token comment">// 创建子元素</span>
          <span class="token keyword">const</span> children <span class="token operator">=</span> vnode<span class="token punctuation">.</span>children
          children<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">subvnode</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            _node<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span><span class="token function">parseVNode</span><span class="token punctuation">(</span>subvnode<span class="token punctuation">)</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
          <span class="token keyword">return</span> _node
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">const</span> Mustache <span class="token operator">=</span> <span class="token regex">/\{\{(.+?)\}\}/g</span>
      <span class="token comment">// 根据路径访问对象成员</span>
      <span class="token keyword">function</span> <span class="token function">getValueByPath</span><span class="token punctuation">(</span><span class="token parameter">obj<span class="token punctuation">,</span> path</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> paths <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span> <span class="token comment">// a.b.c</span>
        <span class="token comment">// 先取到a.b，再取到a.b.c</span>
        <span class="token keyword">let</span> res <span class="token operator">=</span> obj
        <span class="token keyword">let</span> prop <span class="token operator">=</span> <span class="token string">''</span>
        <span class="token comment">// 如果没有值最后为undefined</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>prop <span class="token operator">=</span> paths<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          res <span class="token operator">=</span> res<span class="token punctuation">[</span>prop<span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> res
      <span class="token punctuation">}</span>
      <span class="token comment">// 让模板与数据结合</span>
      <span class="token keyword">function</span> <span class="token function">combine</span><span class="token punctuation">(</span><span class="token parameter">vnode<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> _type <span class="token operator">=</span> vnode<span class="token punctuation">.</span>type
        <span class="token keyword">const</span> _data <span class="token operator">=</span> vnode<span class="token punctuation">.</span>data
        <span class="token keyword">const</span> _value <span class="token operator">=</span> vnode<span class="token punctuation">.</span>value
        <span class="token keyword">const</span> _tag <span class="token operator">=</span> vnode<span class="token punctuation">.</span>tag
        <span class="token keyword">const</span> _children <span class="token operator">=</span> vnode<span class="token punctuation">.</span>children

        <span class="token keyword">let</span> _vnode <span class="token operator">=</span> <span class="token keyword">null</span>
        <span class="token comment">// 对文本节点的处理</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>_type <span class="token operator">===</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          _parsedValue <span class="token operator">=</span> _value<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span>Mustache<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">_<span class="token punctuation">,</span> g</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
            <span class="token function">getValueByPath</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> g<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
          <span class="token punctuation">)</span>
          _vnode <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VNode</span><span class="token punctuation">(</span>_tag<span class="token punctuation">,</span> _data<span class="token punctuation">,</span> _parsedValue<span class="token punctuation">,</span> _type<span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>_type <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">// 元素节点</span>
          _vnode <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VNode</span><span class="token punctuation">(</span>_tag<span class="token punctuation">,</span> _data<span class="token punctuation">,</span> _value<span class="token punctuation">,</span> _type<span class="token punctuation">)</span>
          _children<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">_subvnode</span> <span class="token operator">=&gt;</span>
            _vnode<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span><span class="token function">combine</span><span class="token punctuation">(</span>_subvnode<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">)</span>
          <span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> _vnode
      <span class="token punctuation">}</span>
      <span class="token keyword">class</span> <span class="token class-name">VNode</span> <span class="token punctuation">{</span>
        <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">tag<span class="token punctuation">,</span> data<span class="token punctuation">,</span> value<span class="token punctuation">,</span> type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>tag <span class="token operator">=</span> tag <span class="token operator">&amp;&amp;</span> tag<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>data <span class="token operator">=</span> data
          <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> value
          <span class="token keyword">this</span><span class="token punctuation">.</span>type <span class="token operator">=</span> type
          <span class="token keyword">this</span><span class="token punctuation">.</span>children <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
        <span class="token function">appendChild</span><span class="token punctuation">(</span><span class="token parameter">vnode</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>children<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>vnode<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">class</span> <span class="token class-name">MyVue</span> <span class="token punctuation">{</span>
        <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>_options <span class="token operator">=</span> options
          <span class="token keyword">this</span><span class="token punctuation">.</span>_data <span class="token operator">=</span> options<span class="token punctuation">.</span>data
          <span class="token function">reactify</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_data<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token comment">// 先传入实例</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>_el <span class="token operator">=</span> options<span class="token punctuation">.</span>el
          <span class="token keyword">const</span> elm <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>el<span class="token punctuation">)</span> <span class="token comment">// 在Vue中这里是字符串，我们这里简化为DOM</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>_template <span class="token operator">=</span> elm
          <span class="token keyword">this</span><span class="token punctuation">.</span>_parent <span class="token operator">=</span> elm<span class="token punctuation">.</span>parentNode
          <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">mount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 挂载</span>
        <span class="token punctuation">}</span>
        <span class="token function">mount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">// 需要提供一个render方法来生成虚拟DOM,引入Vue是可以传入自定义render方法的，该方法让用户提供自定义的VNode</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_options<span class="token punctuation">.</span>render <span class="token operator">!==</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>render <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">createRenderFn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 带有缓存</span>
          <span class="token punctuation">}</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">mountComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token function">mountComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token comment">// 执行 mountComponent函数</span>
          <span class="token keyword">const</span> <span class="token function-variable function">mount</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
          <span class="token comment">// 在Vue中其实是交给 watcher 来调用，现在就这样写</span>
          <span class="token function">mount</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        <span class="token comment">/*
          在真正的 Vue中使用了二次提交的设计结构
          1.在页面中的DOM和虚拟DOM是一一对应的关系
          2.先由 AST 和数据生成VNode（这个是新产生的VNode）
          3.将原来的旧的VNode与新的VNode进行比较（使用diff算法），再更新（update）
        */</span>
        <span class="token comment">// 这里是生成render函数，目的是缓存抽象语法树（现在这里我们先使用虚拟DOM来进行模拟）</span>
        <span class="token function">createRenderFn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">const</span> ast <span class="token operator">=</span> <span class="token function">getVNode</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_template<span class="token punctuation">)</span>
          <span class="token comment">// 在Vue中是直接：AST + DATA -&gt; VNode</span>

          <span class="token comment">// 我们这里做简化，将模板转换的直接的空的VNode转换为由数据的VNode</span>
          <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> _tmp <span class="token operator">=</span> <span class="token function">combine</span><span class="token punctuation">(</span>ast<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_data<span class="token punctuation">)</span>
            <span class="token keyword">return</span> _tmp
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 将虚拟DOM渲染到页面中，diff算法就在这个地方</span>
        <span class="token function">update</span><span class="token punctuation">(</span><span class="token parameter">vnode</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">const</span> realDOM <span class="token operator">=</span> <span class="token function">parseVNode</span><span class="token punctuation">(</span>vnode<span class="token punctuation">)</span>
          <span class="token comment">// 对这个过程简化，直接生成 DOM 通过替换的方式到页面中去，真实情况不是这样全部替换，而是通过diff算法一级一级比较然后改变原来的对象</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>_parent<span class="token punctuation">.</span><span class="token function">replaceChild</span><span class="token punctuation">(</span>realDOM<span class="token punctuation">,</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_el<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyVue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        el<span class="token operator">:</span> <span class="token string">'#root'</span><span class="token punctuation">,</span>
        data<span class="token operator">:</span> <span class="token punctuation">{</span>
          name<span class="token operator">:</span> <span class="token string">'张三'</span><span class="token punctuation">,</span>
          age<span class="token operator">:</span> <span class="token number">18</span><span class="token punctuation">,</span>
          gender<span class="token operator">:</span> <span class="token string">'男'</span><span class="token punctuation">,</span>
          datas<span class="token operator">:</span> <span class="token punctuation">{</span>
            info<span class="token operator">:</span> <span class="token string">'11'</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br><span class="line-number">180</span><br><span class="line-number">181</span><br><span class="line-number">182</span><br><span class="line-number">183</span><br><span class="line-number">184</span><br><span class="line-number">185</span><br><span class="line-number">186</span><br><span class="line-number">187</span><br><span class="line-number">188</span><br><span class="line-number">189</span><br><span class="line-number">190</span><br><span class="line-number">191</span><br><span class="line-number">192</span><br><span class="line-number">193</span><br><span class="line-number">194</span><br><span class="line-number">195</span><br><span class="line-number">196</span><br><span class="line-number">197</span><br><span class="line-number">198</span><br><span class="line-number">199</span><br><span class="line-number">200</span><br><span class="line-number">201</span><br><span class="line-number">202</span><br><span class="line-number">203</span><br><span class="line-number">204</span><br><span class="line-number">205</span><br><span class="line-number">206</span><br><span class="line-number">207</span><br><span class="line-number">208</span><br><span class="line-number">209</span><br><span class="line-number">210</span><br><span class="line-number">211</span><br><span class="line-number">212</span><br><span class="line-number">213</span><br><span class="line-number">214</span><br><span class="line-number">215</span><br><span class="line-number">216</span><br><span class="line-number">217</span><br><span class="line-number">218</span><br><span class="line-number">219</span><br><span class="line-number">220</span><br><span class="line-number">221</span><br><span class="line-number">222</span><br><span class="line-number">223</span><br><span class="line-number">224</span><br><span class="line-number">225</span><br><span class="line-number">226</span><br><span class="line-number">227</span><br><span class="line-number">228</span><br><span class="line-number">229</span><br><span class="line-number">230</span><br><span class="line-number">231</span><br><span class="line-number">232</span><br><span class="line-number">233</span><br><span class="line-number">234</span><br><span class="line-number">235</span><br><span class="line-number">236</span><br><span class="line-number">237</span><br><span class="line-number">238</span><br><span class="line-number">239</span><br><span class="line-number">240</span><br><span class="line-number">241</span><br><span class="line-number">242</span><br><span class="line-number">243</span><br><span class="line-number">244</span><br><span class="line-number">245</span><br><span class="line-number">246</span><br><span class="line-number">247</span><br><span class="line-number">248</span><br><span class="line-number">249</span><br><span class="line-number">250</span><br><span class="line-number">251</span><br><span class="line-number">252</span><br><span class="line-number">253</span><br><span class="line-number">254</span><br><span class="line-number">255</span><br><span class="line-number">256</span><br><span class="line-number">257</span><br><span class="line-number">258</span><br><span class="line-number">259</span><br><span class="line-number">260</span><br><span class="line-number">261</span><br><span class="line-number">262</span><br><span class="line-number">263</span><br></div></div><h5 id="_18-7-3-5-代理方法"><a href="#_18-7-3-5-代理方法" class="header-anchor">#</a> 18.7.3.5 代理方法</h5> <p>代理方法的实现就是将 Vue 上的<code>this._data</code>上的成员映射到<code>this</code>上。由于需要在更新数据的时候，更新页面的内容，所有<code>this._data</code>访问的成员与<code>this</code>访问的成员应该是同一个成员。</p> <p><strong>我们现在对我们自己的简易框架做一点修改：</strong></p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">MyVue</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_options <span class="token operator">=</span> options<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_data <span class="token operator">=</span> options<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_el <span class="token operator">=</span> options<span class="token punctuation">.</span>el<span class="token punctuation">;</span>
    <span class="token keyword">const</span> elm <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>el<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 在Vue中这里是字符串，我们这里简化为DOM</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_template <span class="token operator">=</span> elm<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_parent <span class="token operator">=</span> elm<span class="token punctuation">.</span>parentNode<span class="token punctuation">;</span>
    <span class="token comment">// &lt;------------------------------&gt;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">initData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 将data进行响应式转换，代理</span>
    <span class="token comment">// &lt;------------------------------&gt;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">mount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 挂载</span>
  <span class="token punctuation">}</span>
  <span class="token function">mount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 需要提供一个render方法来生成虚拟DOM,引入Vue是可以传入自定义render方法的，该方法让用户提供自定义的VNode</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_options<span class="token punctuation">.</span>render <span class="token operator">!==</span> <span class="token string">&quot;function&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>render <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">createRenderFn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 带有缓存</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">mountComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">mountComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 执行 mountComponent函数</span>
    <span class="token keyword">const</span> <span class="token function-variable function">mount</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token comment">// 在Vue中其实是交给 watcher 来调用，现在就这样写</span>
    <span class="token function">mount</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">/*
          在真正的 Vue中使用了二次提交的设计结构
          1.在页面中的DOM和虚拟DOM是一一对应的关系
          2.先由 AST 和数据生成VNode（这个是新产生的VNode）
          3.将原来的旧的VNode与新的VNode进行比较（使用diff算法），再更新（update）
        */</span>
  <span class="token comment">// 这里是生成render函数，目的是缓存抽象语法树（现在这里我们先使用虚拟DOM来进行模拟）</span>
  <span class="token function">createRenderFn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> ast <span class="token operator">=</span> <span class="token function">getVNode</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_template<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 在Vue中是直接：AST + DATA -&gt; VNode</span>

    <span class="token comment">// 我们这里做简化，将模板转换的直接的空的VNode转换为由数据的VNode</span>
    <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> _tmp <span class="token operator">=</span> <span class="token function">combine</span><span class="token punctuation">(</span>ast<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_data<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> _tmp<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 将虚拟DOM渲染到页面中，diff算法就在这个地方</span>
  <span class="token function">update</span><span class="token punctuation">(</span><span class="token parameter">vnode</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> realDOM <span class="token operator">=</span> <span class="token function">parseVNode</span><span class="token punctuation">(</span>vnode<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 对这个过程简化，直接生成 DOM 通过替换的方式到页面中去，真实情况不是这样全部替换，而是通过diff算法一级一级比较然后改变原来的对象</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>_parent<span class="token punctuation">.</span><span class="token function">replaceChild</span><span class="token punctuation">(</span>realDOM<span class="token punctuation">,</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_el<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// &lt;-------------------------------------------&gt;</span>
  <span class="token function">initData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 遍历this._data的成员，将属性转换为响应式，同时代理到实例上</span>
    Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_data<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">key</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// 响应式化</span>
      <span class="token function">reactify</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>_data<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// 代理</span>
      <span class="token comment">/*
              将this._data[key]映射到this[key]上，就是提供代理，在访问this[key]的时候相当于是在访问this._data[key]
            */</span>
      <span class="token function">proxy</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token string">&quot;_data&quot;</span><span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// &lt;-------------------------------------------&gt;</span>
<span class="token punctuation">}</span>
<span class="token comment">// &lt;-------------------------------------------&gt;</span>
<span class="token keyword">function</span> <span class="token function">proxy</span><span class="token punctuation">(</span><span class="token parameter">target<span class="token punctuation">,</span> prop<span class="token punctuation">,</span> key</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    enumerable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    configurable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> target<span class="token punctuation">[</span>prop<span class="token punctuation">]</span><span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">set</span><span class="token punctuation">(</span>newValue<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      target<span class="token punctuation">[</span>prop<span class="token punctuation">]</span><span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> newValue<span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// &lt;-------------------------------------------&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br></div></div><h3 id="_18-8-发布订阅模式"><a href="#_18-8-发布订阅模式" class="header-anchor">#</a> 18.8 发布订阅模式</h3> <p><strong>发布订阅模式的目标是通过解耦, 让各个模块之间没有紧密的联系。</strong></p> <p>在之前我们的简单模板中的处理办法是属性在更新的 时候调用<code>mountComponent</code>方法。但是这种方法目前还存在着问题，</p> <p>现在调用该方法更新的是全部的页面，也就是当前虚拟 DOM 对应的页面 DOM。</p> <p><strong>但是，在 Vue 中, 整个的更新是按照组件为单位进行断, 已节点为单位进行更新：</strong></p> <ul><li><p>如果代码中没有自定义组件，那么在比较算法的时候，会将全部的模板对应的虚拟 DOM 进行比较。</p></li> <li><p>如果代码中含有自定义组件，那么在比较算法的时候，就会判断更新的是哪一些组件中的属性，只会判断更新数据的组件，其他组件不会更新。</p></li></ul> <p><strong>所以，我们的目标是如果修改了什么属性，就尽可能只更新这些属性对应的页面 DOM。</strong></p> <p><strong>发布订阅模式 ( 形式不局限于函数, 形式可以是对象等 )</strong>：</p> <ol><li><p>中间的<strong>全局的容器</strong>，用来<strong>存储</strong>可以被触发的东西（函数, 对象）。</p></li> <li><p>需要一个方法，可以往容器中<strong>传入</strong>东西（函数, 对象）。</p></li> <li><p>需要一个方法，可以将容器中的东西取出来<strong>使用</strong>（函数调用, 对象的方法调用）。</p></li></ol> <h4 id="_18-8-1-事件模型"><a href="#_18-8-1-事件模型" class="header-anchor">#</a> 18.8.1 事件模型</h4> <p><strong>总的来说发布订阅模式的一种事件就是创立一个事件模型，当需要更新的时候触发对应的事件实现更新。</strong></p> <p>该事件模型需要做到以下几点：</p> <ul><li><p>有一个<code>event</code>对象。</p></li> <li><p>有<code>on</code>，<code>off</code>，<code>emit</code>等绑定、取消、触发事件的方法。</p></li> <li><p>通过<code>event.on('事件名', 处理函数)</code>订阅事件，可以同时对同一个事件订阅多个处理函数。</p></li> <li><p>通过<code>event.off()</code>方法传入 0、1、2 个参数可以分别移除所有处理函数、对应事件名的所有处理函数和对应事件名的对应处理函数。</p></li> <li><p>通过<code>event.emit('事件名', 参数)</code>, 先前注册的事件处理函数就会依次调用。</p></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> event <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> eventObjs <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token comment">/*
            注册事件：可以连续注册，可以注册多个事件
          */</span>
    <span class="token function">on</span><span class="token punctuation">(</span><span class="token parameter">type<span class="token punctuation">,</span> handler</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token punctuation">(</span>eventObjs<span class="token punctuation">[</span>type<span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token punctuation">(</span>eventObjs<span class="token punctuation">[</span>type<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>handler<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">/*
            移除事件：
            1.如果没有参数，移除所有事件
            2.如果只带有事件名参数，就移除这个事件名下的所有事件
            3.如果带有两个参数，那么就移除某一个事件的具体函数
          */</span>
    <span class="token function">off</span><span class="token punctuation">(</span><span class="token parameter">type<span class="token punctuation">,</span> handler</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>arguments<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 没有参数，移除所有事件</span>
        eventObjs <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>arguments<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        eventObjs<span class="token punctuation">[</span>type<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

        <span class="token comment">//只有事件类型，移除该事件的所有处理函数</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>arguments<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 移除type事件的handler处理函数</span>
        <span class="token comment">// 使用循环移除所有的改函数对应的type事件</span>
        <span class="token keyword">const</span> _events <span class="token operator">=</span> eventObjs<span class="token punctuation">[</span>type<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>events<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 循环数组，倒着防止序号影响</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> _events<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>_events<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">===</span> handler<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            _events<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">/*
            发射事件：触发事件，包装事件，传递给事件处理函数
          */</span>
    <span class="token function">emit</span><span class="token punctuation">(</span><span class="token parameter">type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> _events <span class="token operator">=</span> eventObjs<span class="token punctuation">[</span>type<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> args <span class="token operator">=</span> <span class="token class-name">Array</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>arguments<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 获得arguments从1开始后的所有参数，返回数组</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>_events<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> _events<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        _events<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">/*
    测试
*/</span>

<span class="token comment">//注册事件</span>
event<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&quot;click&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;click event&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  event<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">&quot;click&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br></div></div><h4 id="_18-8-2-vue-中的模型"><a href="#_18-8-2-vue-中的模型" class="header-anchor">#</a> 18.8.2 Vue 中的模型</h4> <p><strong>页面中的变更（diff）是以组件为单位的</strong>：</p> <ul><li><p>如果页面中只有一个组件 ( Vue 实例 ), 不会有性能损失</p></li> <li><p>但是如果页面中有多个组件（多 watcher 的一种情况），第一次会有多个组件的 watcher 存入到全局 watcher 容器中。如果修改了局部的数据（例如其中一个组件的数据），表示只会对该组件进行 diff 算法, 也就是说只会重新生成该组件的抽象语法树，只会访问该组件的 watcher，然后调用完改 watcher 后，再次往全局存储的该组件的新的 watcher ，页面更新的时候也就只需要更新一部分。</p></li></ul> <h3 id="_18-9-flow"><a href="#_18-9-flow" class="header-anchor">#</a> 18.9 Flow</h3> <p>Flow 是一个静态的检测工具，语法与 TypeScript 类似，在 Vue 2.x 中是使用它来进行编码的，具体的用法可查看<a href="https://flow.org/en/docs/getting-started/" target="_blank" rel="noopener noreferrer">官方文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="_18-10-vue-的-mvvm-模式"><a href="#_18-10-vue-的-mvvm-模式" class="header-anchor">#</a> 18.10 Vue 的 MVVM 模式</h3> <p><img src="/assets/img/8.edaeeb73.png" alt="image-20200617161846845"></p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次编辑于:</span> <span class="time">2020年8月3日 21:58</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev"><a href="/FrontEnd/Vue/vue17/" class="prev"><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" class="icon prev-icon"><path d="M906.78272 588.78976c-0.02048 8.4992-6.88128 15.36-15.38048 15.37024l-443.6992-0.01024 75.70432 191.68256c2.51904 6.42048 0.48128 13.76256-5.03808 17.90976-5.51936 4.16768-13.13792 4.1472-18.61632-0.09216l-376.5248-289.47456c-3.77856-2.89792-6.00064-7.41376-6.00064-12.16512 0-4.78208 2.22208-9.27744 6.00064-12.1856l376.5248-289.47456c2.7648-2.11968 6.06208-3.19488 9.37984-3.19488 3.23584 0 6.5024 1.03424 9.23648 3.10272 5.51936 4.1472 7.5776 11.48928 5.03808 17.90976L447.68256 419.84l443.71968-0.01024c8.4992 0.01024 15.36 6.88128 15.36 15.36L906.78272 588.78976z" fill="currentColor"></path></svg>
        17.Mixins
      </a></span> <!----></p></div> <div class="comments-wrapper"><div class="valine-wrapper"><div id="valine"></div></div></div> <div class="footer-wrapper"><div class="media-links-wrapper"><div class="media-link"><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" class="icon icon-instagram"><path d="M544.059897 959.266898h-64.949141c-228.633593 0-415.697442-187.063849-415.697442-415.697442v-64.949141c0-228.633593 187.063849-415.697442 415.697442-415.697442h64.949141c228.633593 0 415.697442 187.063849 415.697442 415.697442v64.949141C959.756315 772.203049 772.692466 959.266898 544.059897 959.266898z" fill="#181818"></path> <path d="M509.715712 393.059337c-65.754939 0-119.059433 53.304494-119.059434 119.059434s53.304494 119.059433 119.059434 119.059433 119.059433-53.304494 119.059433-119.059433S575.470651 393.059337 509.715712 393.059337zM509.715712 589.593102c-42.787144 0-77.474331-34.686163-77.474331-77.474331s34.686163-77.474331 77.474331-77.474331 77.474331 34.686163 77.474331 77.474331S552.50388 589.593102 509.715712 589.593102zM740.495369 411.102245c0-72.572992-57.189115-129.762107-129.762107-129.762107 0 0-51.329419-1.642312-101.016526-1.642312s-99.374214 1.642312-99.374214 1.642312c-72.572992 0-131.405443 58.832451-131.405443 131.405442 0 0-1.642312 46.455725-1.642312 94.447278 0 51.274129 1.642312 104.302174 1.642312 104.302175 0 72.572992 58.832451 131.405443 131.405443 131.405442 0 0 46.455725 1.642312 94.447278 1.642312 51.274129 0 105.944486-1.642312 105.944486-1.642312 72.572992 0 129.762107-57.189115 129.762106-129.762106 0 0 1.642312-52.43112 1.642312-102.659863C742.137681 461.34225 740.495369 411.102245 740.495369 411.102245zM698.955317 605.10394c0 59.510263-36.743149 96.253412-96.253412 96.253412 0 0-54.980594 1.347433-97.025421 1.347433-39.353032 0-87.302606-1.347433-87.302606-1.347433-59.509239 0-97.895724-38.387509-97.895724-97.895724 0 0-1.347433-53.338282-1.347433-95.383109 0-39.353032 1.347433-88.944918 1.347433-88.944918 0-59.510263 38.387509-96.253412 97.895724-96.253412 0 0 50.598365-1.347433 91.342858-1.347433 40.744493 0 92.98517 1.347433 92.985169 1.347433 59.510263 0 96.253412 36.743149 96.253412 96.253412 0 0 1.347433 51.348873 1.347433 91.637737C700.301726 551.959173 698.955317 605.10394 698.955317 605.10394zM634.472043 360.019582c-15.887629 0-28.768106 12.943958-28.768106 28.910426 0 15.966468 12.880477 28.909402 28.768106 28.909402 15.887629 0 28.767082-12.942934 28.767082-28.909402C663.239125 372.962516 650.359672 360.019582 634.472043 360.019582z" fill="#FFFFFF"></path></svg></div><div class="media-link"><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" class="icon icon-github"><path d="M544.059897 959.266898h-64.949141c-228.633593 0-415.697442-187.063849-415.697442-415.697442v-64.949141c0-228.633593 187.063849-415.697442 415.697442-415.697442h64.949141c228.633593 0 415.697442 187.063849 415.697442 415.697442v64.949141C959.756315 772.203049 772.692466 959.266898 544.059897 959.266898z" fill="#171515"></path> <path d="M510.25018 263.810197c-136.001664 0-246.287424 110.272449-246.287424 246.317117 0 108.810341 70.566177 201.127938 168.449614 233.700801 12.315293 2.258691 16.811173-5.344681 16.811173-11.87195 0-5.847409-0.212968-21.336746-0.332763-41.891244-68.513287 14.884221-82.969523-33.01723-82.969523-33.01723-11.199258-28.453773-27.346953-36.028477-27.346953-36.028477-22.362679-15.282512 1.691459-14.972275 1.691458-14.972275 24.717616 1.741629 37.727103 25.382117 37.727103 25.382117 21.971555 37.639048 57.645768 26.770506 71.681188 20.46542 2.238213-15.917321 8.600637-26.770506 15.6378-32.927128-54.692882-6.216008-112.191211-27.346953-112.191211-121.73075 0-26.888253 9.596877-48.875166 25.352425-66.092822-2.533092-6.231366-10.985266-31.273553 2.414322-65.183612 0 0 20.680436-6.62249 67.731038 25.249013 19.646312-5.463452 40.715824-8.195178 61.66247-8.2904 20.915929 0.095221 41.987489 2.827971 61.662469 8.2904 47.022957-31.872526 67.664486-25.249012 67.664486-25.249013 13.437471 33.910058 4.98325 58.952245 2.451181 65.183612 15.78524 17.217656 25.317612 39.203545 25.317613 66.092822 0 94.620315-57.587406 115.441023-112.457421 121.538259 8.844321 7.604396 16.721071 22.637081 16.721071 45.612044 0 32.927128-0.302046 59.492857-0.302046 67.56824 0 6.586654 4.436495 14.249412 16.936087 11.843282 97.787192-32.634297 168.295007-124.89046 168.295007-233.672133C756.569344 374.082647 646.281536 263.810197 510.25018 263.810197z" fill="#FFFFFF"></path></svg></div><div class="media-link"><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" class="icon icon-gmail"><path d="M544.059897 959.266898h-64.949141c-228.633593 0-415.697442-187.063849-415.697442-415.697442v-64.949141c0-228.633593 187.063849-415.697442 415.697442-415.697442h64.949141c228.633593 0 415.697442 187.063849 415.697442 415.697442v64.949141C959.756315 772.203049 772.692466 959.266898 544.059897 959.266898z" fill="#DB4437"></path> <path d="M305.878574 312.986386h409.365735v387.916361H305.878574V312.986386z" fill="#E67C73"></path> <path d="M310.328379 312.986386h-9.35524c-22.818308 0-41.416161 19.167133-41.416161 42.807621V658.095125c0 23.640488 18.528229 42.807622 41.416161 42.807622h21.951077V420.55373l187.637225 149.370534 187.637225-149.370534v280.349017h21.951077c22.886909 0 41.416161-19.168157 41.416162-42.807622V355.794007c0-23.640488-18.574304-42.807622-41.416162-42.807621h-9.35524L510.561441 484.262947 310.328379 312.986386z" fill="#FFFFFF"></path></svg></div><div class="media-link"><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" class="icon icon-qq"><path d="M544.059897 959.266898h-64.949141c-228.633593 0-415.697442-187.063849-415.697442-415.697442v-64.949141c0-228.633593 187.063849-415.697442 415.697442-415.697442h64.949141c228.633593 0 415.697442 187.063849 415.697442 415.697442v64.949141c-0.001024 228.633593-187.064873 415.697442-415.697442 415.697442z" fill="#5EAADE"></path> <path d="M729.459932 627.30075c-3.156638-39.628458-24.044923-83.747676-32.624058-105.910698l-22.084182-57.046794c-0.701361-23.73059 6.312253-78.322108-30.510759-146.611164s-110.820228-74.444654-124.497288-75.146016c-13.67706-0.701361-99.247252-1.402723-141.330987 72.944663-42.083735 74.347385-30.744205 148.812517-30.744205 148.812517l-23.523765 57.47785c-0.001024 0.002048-10.961716 26.222727-20.429584 58.135185-9.468891 31.913482-18.937783 82.063385-9.468892 92.233638 9.468891 10.170253 43.836626-46.643096 46.993265-51.902795 0 0 2.455277 27.179036 8.942615 41.382373l0.809893 1.776441 0.330715 0.722863 0.378837 0.826276 0.299999 0.652215 0.444366 0.960404 0.202729 0.435151a281.465052 281.465052 0 0 0 1.917738 4.024893l0.188394 0.386005c0.231398 0.473035 0.467916 0.953237 0.711601 1.442655l0.145391 0.291807c6.886653 13.807094 18.611164 33.823028 37.443487 50.420209l0.017406 0.015358-1.183612 0.387029c-10.666837 3.516022-31.69437 11.209497-40.624698 19.819348-1.717056 1.655623-2.987697 3.345033-3.650151 5.045707-5.376422 13.793783 4.208169 15.430976 20.574976 16.365783 16.365783 0.934807 94.922361 3.039916 132.563457-2.220807 0.407506-0.056314 0.787368-0.113651 1.171325-0.170989 2.710224 0.094197 5.32318 0.14232 7.828627 0.16075l0.151535 0.001024c0.83549 0.005119 1.66279 0.008191 2.474731 0.008191 0.496584 0 1.01467-0.002048 1.541971-0.006144l0.209896-0.001023a222.59267 222.59267 0 0 0 5.462429-0.106484c0.260067 0.037884 0.507847 0.075768 0.778152 0.113651 37.64212 5.260723 116.197674 3.156638 132.563457 2.220807 16.365783-0.934807 25.951397-2.572 20.573952-16.365783-4.301342-11.03646-34.17422-21.619339-45.956069-25.412834a141.388325 141.388325 0 0 0 7.958661-7.645351l0.236517-0.244709a142.494121 142.494121 0 0 0 2.531045-2.702033c42.433903-46.643096 38.927096-76.101301 40.681011-92.935 0 0 35.775577 51.552626 43.488506 53.306542 7.712928 1.753916 10.168205-6.311229 7.011566-45.940711z" fill="#FFFFFF"></path></svg></div><div class="media-link"><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" class="icon icon-wechat"><path d="M544.059897 959.266898h-64.949141c-228.633593 0-415.697442-187.063849-415.697442-415.697442v-64.949141c0-228.633593 187.063849-415.697442 415.697442-415.697442h64.949141c228.633593 0 415.697442 187.063849 415.697442 415.697442v64.949141C959.756315 772.203049 772.692466 959.266898 544.059897 959.266898z" fill="#2DC100"></path> <path d="M618.871102 424.812069c-52.6789 2.760395-98.49572 18.754507-135.696546 54.89766-37.587854 36.50356-54.743053 81.262707-50.047514 136.728622-20.586238-2.580191-39.34177-5.366183-58.19969-6.965492-6.552866-0.516038-14.292415 0.258019-19.786584 3.353224-18.316285 10.318716-35.858512 22.030941-56.703793 35.085479 3.818068-17.284208 6.294847-32.505287 10.680148-47.029101 3.173021-10.732366 1.702721-16.691379-8.152175-23.65687-63.256659-44.73355-89.905323-111.652647-69.963108-180.584703 18.470891-63.720479 63.798295-102.417201 125.376806-122.539619 84.100917-27.500536 178.52055 0.567232 229.651335 67.409538 18.733006 24.012159 30.112467 52.935895 32.763306 83.275665L618.871102 424.812069zM737.231222 753.7854c-16.691379-7.429312-31.989249-18.574304-48.241381-20.302622-16.252132-1.702721-33.330539 7.687331-50.305534 9.416673-51.724639 5.288368-98.0319-9.132033-136.263778-44.526725-72.646712-67.331723-62.275777-170.522981 21.799542-225.730878 74.736462-49.015438 184.324956-32.659894 237.003856 35.342474 45.971427 59.386373 40.55405 138.198922-15.55589 188.066232-16.252132 14.447022-22.108756 26.313853-11.686627 45.32638 1.909546 3.508855 2.140944 7.94535 3.250836 12.382869L737.231222 753.7854zM376.397651 403.348361c0.516038-12.640888-10.422129-23.991681-23.373254-24.353112-13.025869-0.533444-24.017278 9.593805-24.550722 22.619674-0.003072 0.078839-0.006143 0.158702-0.008191 0.237542-0.512967 12.869215 9.503704 23.719327 22.372918 24.232294 0.238565 0.009215 0.477131 0.015358 0.715696 0.017406C364.663926 426.584415 375.730078 416.448974 376.397651 403.348361zM502.909946 378.995249c-13.00232 0.258019-23.991681 11.350793-23.733662 23.99168 0.280545 13.104708 11.131681 23.50124 24.23639 23.220696 0.038908-0.001024 0.077815-0.002048 0.116723-0.003072 12.865119 0.104436 23.379398-10.239877 23.483834-23.104996 0.002048-0.278497 0-0.556994-0.008192-0.835491-0.109556-12.96546-10.708817-23.386565-23.673252-23.277009C503.191515 378.989105 503.050218 378.991153 502.909946 378.995249zM547.334283 569.640648c10.628954 0 19.348361-8.332379 19.760986-18.832323 0.384981-10.920761-8.15627-20.086582-19.077031-20.471563-0.176108-0.006143-0.352217-0.010239-0.529349-0.011262-11.041579 0.069624-19.937095 9.076743-19.867471 20.118322 0.001024 0.08703 0.002048 0.175084 0.003072 0.262115C528.092406 561.263219 536.764714 569.595597 547.334283 569.640648zM669.743869 530.351097c-10.452845 0.086006-19.011503 8.337498-19.477371 18.781128-0.570304 10.670933 7.617707 19.782488 18.28864 20.352793 0.310237 0.016382 0.620475 0.025597 0.930712 0.027645 10.654551 0 19.090342-8.07436 19.47737-18.703314 0.528325-10.772298-7.776409-19.934023-18.548706-20.462348-0.223207-0.011263-0.447438-0.01843-0.670645-0.021501V530.351097z" fill="#FFFFFF"></path></svg></div><div class="media-link"><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" class="icon icon-facebook"><path d="M544.059897 959.266898h-64.949141c-228.633593 0-415.697442-187.063849-415.697442-415.697442v-64.949141c0-228.633593 187.063849-415.697442 415.697442-415.697442h64.949141c228.633593 0 415.697442 187.063849 415.697442 415.697442v64.949141C959.756315 772.203049 772.692466 959.266898 544.059897 959.266898z" fill="#3C599B"></path> <path d="M541.542163 743.516854h-96.560577V510.072024h-48.259811v-80.47841h48.259811v-48.290528c0-65.612619 27.246612-104.676916 104.630841-104.676916h64.441295v80.476363h-40.257123c-30.137041 0-32.140784 11.255571-32.140784 32.23191l-0.111604 40.259171h72.977427l-8.547395 80.47841h-64.430032V743.516854z" fill="#FFFFFF"></path></svg></div><div class="media-link"><svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" class="icon icon-twitter"><path d="M544.059897 959.266898h-64.949141c-228.633593 0-415.697442-187.063849-415.697442-415.697442v-64.949141c0-228.633593 187.063849-415.697442 415.697442-415.697442h64.949141c228.633593 0 415.697442 187.063849 415.697442 415.697442v64.949141C959.756315 772.203049 772.692466 959.266898 544.059897 959.266898z" fill="#5EAADE"></path> <path d="M749.736957 364.631161c-17.594445 7.805078-36.512775 13.088326-56.37103 15.458621 20.268834-12.147375 35.835986-31.387205 43.155743-54.311997-18.965428 11.256595-39.963268 19.422081-62.321852 23.821716-17.89342-19.082151-43.405571-30.99608-71.636137-30.996081-54.19937 0-98.136337 43.94311-98.136337 98.156815 0 7.694498 0.861088 15.190363 2.543331 22.372918-81.569872-4.09247-153.87563-43.174172-202.283904-102.558497-8.442958 14.498216-13.284912 31.356488-13.284912 49.348201 0 34.049306 17.326187 64.096245 43.656422 81.696834-16.086262-0.509895-31.221335-4.923865-44.446861-12.276385-0.010239 0.409554-0.010239 0.820132-0.010239 1.239925 0 47.557426 33.822004 87.22991 78.719375 96.248292-8.234086 2.242309-16.905371 3.448446-25.851057 3.448446-6.331707 0-12.475019-0.616379-18.465771-1.76825 12.48321 39.00184 48.725679 67.379845 91.672548 68.170285-33.582415 26.334331-75.897547 42.024349-121.884333 42.024349-7.923849 0-15.736094-0.460748-23.408066-1.370983 43.434239 27.844561 95.01451 44.104884 150.443566 44.104885 180.504839 0 279.220695-149.576335 279.220696-279.294415 0-4.262435-0.090102-8.494153-0.278497-12.707441C719.948038 401.602637 736.583103 384.322524 749.736957 364.631161z" fill="#FFFFFF"></path></svg></div></div> <div class="footer">How easy to do</div> <div class="copyright">Copyright © 2020-present Harry Xiong</div></div> </main></div><div class="global-ui"><!----><!----><div tabindex="-1" role="dialog" aria-hidden="true" class="pswp"><div class="pswp__bg"></div> <div class="pswp__scroll-wrap"><div class="pswp__container"><div class="pswp__item"></div> <div class="pswp__item"></div> <div class="pswp__item"></div></div> <div class="pswp__ui pswp__ui--hidden"><div class="pswp__top-bar"><div class="pswp__counter"></div> <button title="Close (Esc)" class="pswp__button pswp__button--close"></button> <button title="Share" class="pswp__button pswp__button--share"></button> <button title="Toggle fullscreen" class="pswp__button pswp__button--fs"></button> <button title="Zoom in/out" class="pswp__button pswp__button--zoom"></button> <div class="pswp__preloader"><div class="pswp__preloader__icn"><div class="pswp__preloader__cut"><div class="pswp__preloader__donut"></div></div></div></div></div> <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class="pswp__share-tooltip"></div></div> <button title="Previous (arrow left)" class="pswp__button pswp__button--arrow--left"></button> <button title="Next (arrow right)" class="pswp__button pswp__button--arrow--right"></button> <div class="pswp__caption"><div class="pswp__caption__center"></div></div></div></div></div></div></div>
    <script src="/assets/js/app.985acdd6.js" defer></script><script src="/assets/js/vendors~layout-Layout.6602fab5.js" defer></script><script src="/assets/js/vendors~layout-Blog~layout-Layout~layout-NotFound.325e3bb0.js" defer></script><script src="/assets/js/vendors~layout-Blog~layout-Layout.90f03575.js" defer></script><script src="/assets/js/page-18.Vue原码分析.45166ab7.js" defer></script>
  </body>
</html>
